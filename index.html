<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palace Cars - Location de Voiture Agadir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- 
      CORRECTION CRITIQUE (Ligne 9) : 
      'xintegrity' a été remplacé par 'integrity' avec le bon hash.
      Ceci débloque tout le JavaScript de la page.
    -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJd4qFf3F5f5qK2K6Q24L+nkA5bf5F3Gmf0iVCi/2fA/wz2N9H/Gz9oW9sP7Cg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <style>
        /* --- Base and Font Setup --- */
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: #f1f5f9; /* Slate-100 */ 
            color: #334155; /* Slate-700 */ 
            scroll-behavior: smooth; 
            overflow-x: hidden; 
        }

        /* --- Custom Color Palette --- */
        :root {
            --color-primary: #2563eb; /* Blue-600 */
            --color-primary-dark: #1d4ed8; /* Blue-700 */
            --color-primary-light: #60a5fa; /* Blue-400 */
            --color-primary-lighter: #eff6ff; /* Blue-50 */
            --color-accent: #f59e0b; /* Amber-500 */
            --color-accent-dark: #d97706; /* Amber-600 */
            --color-text-dark: #1e293b; /* Slate-800 */
            --color-text-medium: #64748b; /* Slate-500 */
            --color-text-light: #f1f5f9; /* Slate-100 */
            --color-bg-light: #f1f5f9; /* Slate-100 */
            --color-bg-white: #ffffff;
            --color-bg-dark: #0f172a; /* Slate-900 */
            --color-bg-darker: #020617; /* Slate-950 */
            --color-border-light: #e2e8f0; /* Slate-200 */
            --color-border-medium: #cbd5e1; /* Slate-300 */
        }

        /* --- Helper Classes --- */
        .text-primary { color: var(--color-primary); }
        .bg-primary { background-color: var(--color-primary); }
        .hover\:bg-primary-dark:hover { background-color: var(--color-primary-dark); }
        .border-primary { border-color: var(--color-primary); }
        .ring-primary { --tw-ring-color: var(--color-primary); }
        .focus\:border-primary:focus { border-color: var(--color-primary); }
        .focus\:ring-primary:focus { --tw-ring-color: var(--color-primary); }

        .text-accent { color: var(--color-accent); }
        .bg-accent { background-color: var(--color-accent); }
        .hover\:bg-accent-dark:hover { background-color: var(--color-accent-dark); }
        .border-accent { border-color: var(--color-accent); }
        .ring-accent { --tw-ring-color: var(--color-accent); }
        .focus\:border-accent:focus { border-color: var(--color-accent); }
        .focus\:ring-accent:focus { --tw-ring-color: var(--color-accent); }
        .text-shadow-lg { text-shadow: 0 4px 8px rgba(0,0,0,0.5); }

        /* --- Header Styling --- */
        header { 
            transition: background-color 0.3s ease, box-shadow 0.3s ease, padding 0.3s ease; 
        }
        header.scrolled { 
            background-color: var(--color-bg-white); 
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); 
            padding-top: 0.5rem; 
            padding-bottom: 0.5rem;
        }
        header nav a { transition: color 0.3s ease; }
        /* Text color when header is transparent (at top) */
        header:not(.scrolled) nav a:not(.btn-accent) { color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3); } 
        header:not(.scrolled) nav a:not(.btn-accent):hover { color: var(--color-accent); }
        header:not(.scrolled) #mobile-menu-button { color: white; }
        /* Text color when header is scrolled (white bg) */
        header.scrolled nav a { color: var(--color-text-dark); } 
        header.scrolled nav a:hover { color: var(--color-primary); }
        header.scrolled #mobile-menu-button { color: var(--color-text-dark); }

        /* Mobile Menu */
        #mobile-menu { background-color: var(--color-bg-white); }
        #mobile-menu a { color: var(--color-text-dark); }
        #mobile-menu a:hover { background-color: var(--color-primary-lighter); color: var(--color-primary); }

        /* --- Logo Styling (Size, Position, Swap) --- */
        /* Conteneur de logo (taille) */
        .logo-container { 
            position: relative; 
            width: 6rem; /* h-24 (taille initiale grande) */
            height: 6rem; /* w-24 */
            transition: width 0.3s ease, height 0.3s ease;
        }
        /* Rétrécissement au défilement */
        header.scrolled .logo-container {
            width: 4rem; /* h-16 (taille petite) */
            height: 4rem; /* w-16 */
        }
        /* Styles communs aux deux logos */
        .logo-container img {
            position: absolute; top: 0; left: 0;
            height: 100%; width: 100%;
            object-fit: contain;
            border-radius: 9999px; /* rounded-full */
            transition: opacity 0.3s ease-in-out;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* shadow-md */
        }
        
        /* Logique d'affichage pour les logos DESKTOP (centrés) */
        #logo-color-desktop { opacity: 0; }
        #logo-white-desktop { opacity: 1; }
        header.scrolled #logo-color-desktop { opacity: 1; }
        header.scrolled #logo-white-desktop { opacity: 0; }
        
        /* Logique d'affichage pour les logos MOBILE (à gauche) */
        #logo-color-mobile { opacity: 0; }
        #logo-white-mobile { opacity: 1; }
        header.scrolled #logo-color-mobile { opacity: 1; }
        header.scrolled #logo-white-mobile { opacity: 0; }

        /* --- Hero Section Styling --- */
        .hero-bg {
            background-image: linear-gradient(rgba(10, 20, 80, 0.6), rgba(0, 0, 0, 0.8)), url('https://i.imgur.com/2vH1UUR.jpeg');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed; /* Parallax effect */
        }

        /* --- Animations --- */
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        .animate-fade-in-down { animation: fadeInDown 0.8s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
        .animate-fade-in-up { animation: fadeInUp 0.8s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
        .section-animate { opacity: 0; }
        .section-animate.visible { animation: fadeInUp 0.8s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
        
        /* --- Reservation Section Animation (Corrected) --- */
        #reservation {
            /* Marge et padding sont gérés par les classes Tailwind ajoutées/supprimées par JS */
            transition: max-height 0.7s cubic-bezier(0.23, 1, 0.32, 1), 
                        opacity 0.5s ease-out, 
                        padding 0.7s ease, 
                        margin 0.7s ease;
        }

        /* --- Card Styles (Flotte, Disponibles) --- */
        .car-card { 
            transition: transform 0.3s ease, box-shadow 0.4s ease; 
            background-color: var(--color-bg-white); 
            border-radius: 1rem; /* rounded-2xl */ 
            overflow: hidden; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -4px rgba(0,0,0,0.07); 
        }
        .car-card img { transition: transform 0.5s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .car-card:hover { 
            transform: translateY(-12px); 
            box-shadow: 0 25px 50px -12px rgba(37, 99, 235, 0.25); /* Primary color shadow */
        }
        .car-card:hover img { transform: scale(1.1); }
        .car-card.selected { 
            border: 2px solid var(--color-primary); 
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.3), 0 10px 20px rgba(0,0,0,0.1); 
            transform: scale(1.03); 
        }
        .car-card h3, .car-card h4 { color: var(--color-text-dark); font-weight: 700; }
        .car-card p { color: var(--color-text-medium); }
        .car-card .price { color: var(--color-primary); font-weight: 700; font-size: 1.375rem; }
        .car-card .select-car-button { font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s ease; border-radius: 9999px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .car-card .select-car-button:hover:not(:disabled) { transform: translateY(-3px) scale(1.03); box-shadow: 0 10px 15px rgba(0,0,0,0.15); }
        .car-card .select-car-button.selected-btn { background-color: #16a34a; box-shadow: 0 4px 10px rgba(22, 163, 74, 0.3); } /* Green-600 */
        .car-card .select-car-button.selected-btn:hover { background-color: #15803d; box-shadow: 0 6px 12px rgba(21, 128, 61, 0.4); } /* Green-700 */

        /* --- Form Input/Select Styles --- */
        input[type="text"], input[type="tel"], input[type="email"], input[type="date"], select {
            background-color: var(--color-bg-white); border: 1px solid var(--color-border-medium); color: var(--color-text-dark);
            border-radius: 0.75rem; /* rounded-xl */ padding: 1rem 1.25rem; transition: border-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04) inset; font-weight: 500;
        }
        input::placeholder, select option[disabled] { color: #94a3b8; } /* Slate-400 */
        input:focus, select:focus { background-color: white; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.25), 0 2px 4px rgba(0,0,0,0.04) inset; outline: none; }
        input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; opacity: 0.8; filter: invert(0.5); transition: opacity 0.2s ease; }
        input[type="date"]::-webkit-calendar-picker-indicator:hover { opacity: 1; }
        select {
             -webkit-appearance: none; -moz-appearance: none; appearance: none;
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E"); /* Slate-500 */
             background-position: right 1rem center; background-repeat: no-repeat; background-size: 1.25em 1.25em; padding-right: 3rem;
        }
        .time-select { padding: 1rem 0.75rem; padding-right: 2.5rem; }

        /* --- Section Styles --- */
        .section-title { font-size: 2.75rem; font-weight: 800; color: var(--color-text-dark); text-align: center; margin-bottom: 1.5rem; line-height: 1.2; }
        .section-subtitle { font-size: 1.125rem; color: var(--color-text-medium); text-align: center; margin-bottom: 4rem; max-width: 650px; margin-left: auto; margin-right: auto; line-height: 1.8; }
        #reservation-container { background-color: var(--color-bg-light); border-bottom: 1px solid var(--color-border-light); }
        #flotte { background-color: var(--color-bg-white); padding-top: 6rem; padding-bottom: 6rem; }
        #about-us { background-color: var(--color-accent); color: var(--color-text-dark); padding-top: 6rem; padding-bottom: 6rem; }
        #about-us .section-title { color: var(--color-text-dark); }
        #about-us p { color: var(--color-bg-dark); font-weight: 400; line-height: 1.8; }
        #services { background: linear-gradient(145deg, var(--color-primary) 0%, var(--color-primary-dark) 100%); color: white; padding-top: 6rem; padding-bottom: 6rem; }
        #services .section-title, #services .section-subtitle { color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        #services .service-card { background-color: rgba(255, 255, 255, 0.08); border-radius: 1rem; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        #services .service-card h3 { color: white; }
        #services .service-card p { color: var(--color-text-light); opacity: 0.9; }
        #faq { background-color: var(--color-bg-light); padding-top: 6rem; padding-bottom: 6rem; }
        #contact { background: var(--color-bg-darker); color: var(--color-text-light); padding-top: 6rem; padding-bottom: 6rem; }
        #contact h2 { color: white; }
        #contact p { color: var(--color-text-medium); }
        #contact a { color: var(--color-text-light); }
        #contact a:hover { color: var(--color-accent); }
        #contact i { color: var(--color-accent); transition: transform 0.3s ease; }
        #contact a:hover i { transform: scale(1.1); }
        #faq details { transition: all 0.3s ease; border: 1px solid transparent; background-color: var(--color-bg-white); border-radius: 0.75rem; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 1rem; }
        #faq details[open] { border-color: var(--color-primary-light); background-color: var(--color-bg-white); box-shadow: 0 6px 15px rgba(37, 99, 235, 0.15); }
        #faq details > summary { list-style: none; padding: 1.5rem 2rem; font-weight: 600; color: var(--color-text-dark); cursor: pointer; transition: color 0.3s ease; display: flex; justify-content: space-between; align-items: center; }
        #faq details > summary::-webkit-details-marker { display: none; }
        #faq details[open] > summary { color: var(--color-primary); }
        #faq details[open] > summary i { transform: rotate(180deg); color: var(--color-primary); }
        #faq details > summary i { transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1), color 0.3s ease; color: var(--color-primary); font-size: 1.1em; }
        #faq details div { padding: 0 2rem 1.5rem 2rem; color: var(--color-text-medium); line-height: 1.7; border-top: 1px solid var(--color-border-light); }

        /* --- General Button Styles --- */
        .btn { padding: 0.8rem 2rem; border-radius: 9999px; font-weight: 600; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); text-align: center; display: inline-flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; }
        .btn-primary { background-color: var(--color-primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--color-primary-dark); transform: translateY(-3px); box-shadow: 0 8px 15px rgba(37, 99, 235, 0.3); }
        .btn-accent { background-color: var(--color-accent); color: var(--color-bg-dark); }
        .btn-accent:hover:not(:disabled) { background-color: var(--color-accent-dark); transform: translateY(-3px); box-shadow: 0 8px 15px rgba(245, 158, 11, 0.3); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; box-shadow: none; transform: none; }

        /* --- Scroll & Message Box --- */
        html { scroll-padding-top: 80px; }
        body::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }
        #message-box { transition: opacity 0.3s ease, transform 0.3s ease; font-weight: 500; }
    </style>
</head>
<body class="bg-bg-light text-text-dark">

    <!-- 
      HEADER CORRIGÉ
      - Structure à 3 colonnes pour le desktop (justify-between sur la nav)
      - Logo mobile séparé (s'affiche uniquement sur mobile)
      - Logo desktop séparé (centré, caché sur mobile)
    -->
    <header id="main-header" class="fixed top-0 left-0 right-0 z-50 py-4 transition-all duration-300">
        <nav class="container mx-auto px-6 flex justify-between items-center relative">
            
            <!-- Logo (Mobile, visible sur petit écran, à gauche) -->
            <div class="flex-shrink-0 md:hidden">
                 <a href="#accueil" class="logo-container"> <!-- Taille gérée par CSS (w-24/h-24 -> w-16/h-16) -->
                   <img id="logo-white-mobile" src="https://i.imgur.com/uPC4OVz.png" alt="Palace Cars Logo Blanc">
                   <img id="logo-color-mobile" src="https://i.imgur.com/htqH0IE.png" alt="Palace Cars Logo Couleur">
                 </a>
            </div>

            <!-- Navigation Links - Left (Desktop) -->
            <div class="hidden md:flex items-center space-x-8 justify-start flex-1">
                <a href="#accueil" class="hover:text-accent font-medium">Accueil</a>
                <a href="#flotte" class="hover:text-accent font-medium">Notre Flotte</a>
                <a href="#services" class="hover:text-accent font-medium">Services</a>
            </div>

            <!-- Logo - (Centre sur Desktop, caché sur mobile) -->
            <div class="hidden md:flex justify-center absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">
                 <a href="#accueil" class="logo-container"> <!-- Taille gérée par CSS -->
                   <!-- White Logo (Initially Visible) -->
                   <img id="logo-white-desktop" src="https://i.imgur.com/uPC4OVz.png" alt="Palace Cars Logo Blanc">
                   <!-- Color Logo (Initially Hidden) -->
                   <img id="logo-color-desktop" src="https://i.imgur.com/htqH0IE.png" alt="Palace Cars Logo Couleur">
                 </a>
            </div>

            <!-- Navigation Links & Button - Right (Desktop) -->
            <div class="hidden md:flex items-center space-x-8 justify-end flex-1">
                <a href="#faq" class="hover:text-accent font-medium">FAQ</a>
                <a href="#contact" class="hover:text-accent font-medium">Contact</a>
                <a href="#reservation" id="nav-reserve-button" class="btn btn-accent text-sm px-6 py-2">Réserver</a>
            </div>

            <!-- Mobile Menu Button (Hamburger) -->
            <div class="md:hidden flex items-center">
                <button id="mobile-menu-button" class="focus:outline-none p-2 -mr-2">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </nav>
        
        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="md:hidden hidden bg-white shadow-lg mt-2 rounded-md">
             <a href="#accueil" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100">Accueil</a>
             <a href="#flotte" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100">Notre Flotte</a>
             <a href="#services" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100">Services</a>
             <a href="#faq" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100">FAQ</a>
             <a href="#contact" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100">Contact</a>
             <a href="#reservation" id="mobile-reserve-button" class="block px-6 py-3 bg-accent text-slate-900 font-semibold text-center rounded-b-md hover:bg-accent-dark">Réserver en Ligne</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="accueil" class="hero-bg text-white min-h-screen flex items-center justify-center relative">
        <div class="absolute inset-0 bg-gradient-to-t from-black via-blue-900/40 to-transparent opacity-80"></div>
        <div class="container mx-auto px-6 text-center relative z-10 pt-20">
            <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-4 leading-tight text-shadow-lg animate-fade-in-down">Palace Cars Agadir</h1>
            <p class="text-lg md:text-2xl text-gray-200 mb-10 max-w-3xl mx-auto animate-fade-in-up" style="animation-delay: 0.2s;">Location de voitures simple, rapide et aux meilleurs prix.</p>
            <!-- Bouton "Réserver en Ligne" -->
            <button id="hero-reserve-button" class="btn btn-accent text-lg px-10 py-4 animate-fade-in-up shadow-lg hover:shadow-xl hover:scale-105" style="animation-delay: 0.4s;">
                Réserver en Ligne <i class="fas fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
            </button>
        </div>
        <!-- Scroll Down Arrow -->
        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 z-10 animate-bounce hidden md:block">
            <a href="#reservation" id="scroll-down-button">
                <i class="fas fa-chevron-down text-white text-3xl opacity-70 hover:opacity-100 transition-opacity"></i>
            </a>
        </div>
    </section>

    <!-- Reservation Form Section Container -->
    <div id="reservation-container" class="bg-gradient-to-b from-slate-100 to-white">
        <!-- 
            SECTION RÉSERVATION - CORRIGÉE
            Initialement cachée avec des classes Tailwind.
            Le JS va retirer/ajouter des classes pour l'animer.
        -->
        <section id="reservation" class="container mx-auto px-6 max-w-5xl transition-all duration-700 ease-in-out">
            <!-- Le conteneur interne gère le style visuel -->
            <div id="reservation-inner-wrapper" class="bg-white p-8 md:p-16 rounded-2xl shadow-xl border border-gray-100 relative overflow-hidden">
                <!-- Decorative elements -->
                <div class="absolute top-0 left-0 w-32 h-32 bg-blue-100 rounded-full opacity-30 -translate-x-1/3 -translate-y-1/3 filter blur-xl"></div>
                <div class="absolute bottom-0 right-0 w-48 h-48 bg-yellow-100 rounded-full opacity-30 translate-x-1/4 translate-y-1/4 filter blur-xl"></div>

                <div class="relative z-10">
                    <h2 class="section-title mb-10 text-primary">Réservez Votre Véhicule</h2>

                    <!-- Message Box -->
                    <div id="message-box" class="hidden p-4 rounded-lg text-center mb-6"></div>

                    <!-- Formulaire -->
                    <form id="booking-form" class="space-y-6">
                        <!-- Web3Forms Hidden Inputs -->
                         <input type="hidden" name="subject" value="Nouvelle demande de réservation - Palace Cars">
                         <input type="hidden" name="from_name" value="Palace Cars Réservation">
                         <input type="hidden" name="access_key" value="9a2470af-9163-405c-abc9-3aafd98b14fd">
                         <input type="hidden" name="redirect" value="https://web3forms.com/success">

                        <!-- Champs Client -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="nomPrenom" class="block text-sm font-semibold text-gray-700 mb-2">Nom et Prénom <span class="text-red-500">*</span></label>
                                <input type="text" id="nomPrenom" name="nomPrenom" required placeholder="Votre nom complet" class="block w-full">
                            </div>
                            <div>
                                <label for="telephone" class="block text-sm font-semibold text-gray-700 mb-2">Téléphone <span class="text-red-500">*</span></label>
                                <input type="tel" id="telephone" name="telephone" required placeholder="+212 6 XX XX XX XX" class="block w-full">
                            </div>
                        </div>
                         <div>
                            <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">Adresse E-mail <span class="text-red-500">*</span></label>
                            <input type="email" id="email" name="email" required placeholder="votre.email@exemple.com" class="block w-full">
                        </div>

                        <!-- Champs Lieu -->
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="lieuPriseEnCharge" class="block text-sm font-semibold text-gray-700 mb-2">Lieu Prise en Charge <span class="text-red-500">*</span></label>
                                <input type="text" id="lieuPriseEnCharge" name="lieuPriseEnCharge" required placeholder="Aéroport, Hôtel..." class="block w-full">
                            </div>
                            <div>
                                <label for="lieuRetour" class="block text-sm font-semibold text-gray-700 mb-2">Lieu Retour <span class="text-red-500">*</span></label>
                                <!-- Changé en <select> -->
                                <select id="lieuRetour" name="lieuRetour" required class="block w-full">
                                    <option value="" disabled selected>-- Choisissez une option --</option>
                                    <option value="A Agadir">A Agadir</option>
                                    <option value="En dehors d'Agadir">En dehors d'Agadir</option>
                                </select>
                            </div>
                        </div>

                        <!-- Champs Date et Heure -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Date et Heure de Début -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Début Location <span class="text-red-500">*</span></label>
                                <input type="date" id="datePriseEnCharge" name="datePriseEnCharge" required class="block w-full mb-2">
                                 <div class="grid grid-cols-2 gap-3">
                                    <select id="heurePriseEnChargeHeure" name="heurePriseEnChargeHeure" required class="block w-full time-select">
                                        <option value="" disabled selected>Heure</option>
                                    </select>
                                    <select id="heurePriseEnChargeMinute" name="heurePriseEnChargeMinute" required class="block w-full time-select">
                                        <option value="" disabled selected>Minute</option>
                                    </select>
                                 </div>
                            </div>
                             <!-- Date et Heure de Fin -->
                             <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Fin Location <span class="text-red-500">*</span></label>
                                <input type="date" id="dateRetour" name="dateRetour" required class="block w-full mb-2">
                                <div class="grid grid-cols-2 gap-3">
                                    <select id="heureRetourHeure" name="heureRetourHeure" required class="block w-full time-select">
                                        <option value="" disabled selected>Heure</option>
                                    </select>
                                    <select id="heureRetourMinute" name="heureRetourMinute" required class="block w-full time-select">
                                        <option value="" disabled selected>Minute</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Bouton Vérifier Disponibilité -->
                        <div class="text-center pt-8">
                            <button type="button" id="check-availability-button" class="btn btn-primary w-full md:w-auto px-12 py-3.5 text-base disabled:opacity-50 shadow-lg hover:shadow-primary/50">
                                <span class="mr-2">Vérifier la Disponibilité</span>
                                <i class="fas fa-search"></i>
                                <span id="availability-spinner" class="ml-2 inline-block border-2 border-white border-t-transparent rounded-full w-5 h-5 hidden animate-spin"></span>
                            </button>
                        </div>

                        <!-- Champ caché pour stocker la voiture sélectionnée -->
                         <input type="hidden" id="selectedCar" name="voiture">

                    </form> <!-- Fin du formulaire initial -->

                     <!-- Section pour afficher les voitures disponibles -->
                     <div id="available-cars-section" class="mt-16 hidden">
                        <hr class="mb-12 border-gray-200">
                        <h3 class="section-title text-3xl mb-12 text-primary">Voitures Disponibles</h3>
                        <div id="available-cars-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <!-- Les cartes de voitures seront injectées ici -->
                        </div>
                        <p id="no-cars-message" class="text-center text-text-medium mt-8 hidden text-lg">Désolé, aucune voiture n'est disponible pour les dates sélectionnées.</p>

                        <!-- Bouton Soumettre Final -->
                        <div class="text-center mt-16">
                            <button type="button" id="submit-booking-button" class="btn btn-accent w-full md:w-auto px-16 py-4 text-lg hidden disabled:opacity-50 shadow-xl hover:shadow-accent/50">
                                <span>Soumettre la Demande</span>
                                <span id="submit-spinner" class="ml-2 inline-block border-2 border-slate-900 border-t-transparent rounded-full w-5 h-5 hidden animate-spin"></span>
                            </button>
                        </div>
                     </div>
                 </div>
            </div>
        </section> <!-- Fin de #reservation -->
    </div> <!-- Fin de #reservation-container -->

    <!-- Section Qui Sommes Nous (Corrigée) -->
    <section id="about-us" class="py-24 bg-accent section-animate">
        <!-- Conteneur élargi à max-w-6xl et texte aligné à gauche -->
        <div class="container mx-auto px-6 max-w-6xl"> 
            <h2 class="section-title text-text-dark text-center">Qui sommes nous ?</h2>
            <div class="text-left text-text-dark space-y-6 text-base md:text-lg md:leading-relaxed max-w-5xl mx-auto"> <!-- Conteneur de texte élargi -->
                <p>
                    Fondée en 1982, Palacecars s'est imposée comme une agence de location de voitures de référence au cœur d'Agadir. Forte de plus de quatre décennies d'expérience, cette entreprise a su bâtir une réputation solide, fondée sur la fiabilité de son service et une connaissance intime des attentes d'une clientèle locale et internationale. Elle représente une solution de mobilité privilégiée pour tous ceux qui souhaitent découvrir la capitale du Souss, ses plages ensoleillées et son arrière-pays en toute liberté et confiance.
                </p>
                <p>
                    L'agence met un point d'honneur à proposer une flotte de véhicules diversifiée, soigneusement entretenue pour garantir sécurité et confort sur les routes marocaines. Palacecars s'efforce de répondre aux différents besoins de ses clients, en offrant des solutions adaptées à chaque type de séjour, qu'il s'agisse de déplacements professionnels ou de vacances. L'engagement de l'agence se traduit par un service client personnalisé, des procédures de location simplifiées et une tarification transparente, assurant ainsi une expérience de conduite agréable et sans tracas.
                </p>
            </div>
        </div>
    </section>

    <!-- Featured Cars Section -->
    <section id="flotte" class="py-24 bg-white section-animate">
        <div class="container mx-auto px-6">
            <h2 class="section-title">Notre Flotte</h2>
            <p class="section-subtitle">Des véhicules récents et bien entretenus pour tous vos besoins.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Car Card 1 -->
                <div class="car-card">
                     <div class="relative group overflow-hidden rounded-t-lg">
                         <img src="https://placehold.co/300x200/e2e8f0/334155?text=Logan+D+24" alt="Dacia Logan Diesel 2024" class="w-full h-52 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                         <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl mb-2">Dacia Logan Diesel 2024</h3>
                        <p class="mb-4 text-sm h-10 text-text-medium">Économique et fiable, idéale pour la ville.</p>
                        <div class="flex justify-between items-center mt-4">
                            <p class="text-xl price">250 Dhs <span class="text-sm font-normal text-text-medium">/ jour</span></p>
                            <a href="#reservation" class="btn btn-primary text-xs px-4 py-2 reserve-now-link">Réserver</a>
                        </div>
                    </div>
                </div>
                <!-- Car Card 2 -->
                <div class="car-card">
                    <div class="relative group overflow-hidden rounded-t-lg">
                        <img src="https://placehold.co/300x200/e2e8f0/334155?text=Logan+D+25" alt="Dacia Logan Diesel 2025" class="w-full h-52 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                    </div>
                   <div class="p-6">
                       <h3 class="text-xl mb-2">Dacia Logan Diesel 2025</h3>
                       <p class="mb-4 text-sm h-10 text-text-medium">Le dernier modèle, confort amélioré.</p>
                       <div class="flex justify-between items-center mt-4">
                           <p class="text-xl price">250 Dhs <span class="text-sm font-normal text-text-medium">/ jour</span></p>
                           <a href="#reservation" class="btn btn-primary text-xs px-4 py-2 reserve-now-link">Réserver</a>
                       </div>
                   </div>
               </div>
                <!-- Car Card 3 -->
                <div class="car-card">
                    <div class="relative group overflow-hidden rounded-t-lg">
                        <img src="https://placehold.co/300x200/e2e8f0/334155?text=Sandero+E" alt="Dacia Sandero Essence" class="w-full h-52 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl mb-2">Dacia Sandero Essence</h3>
                        <p class="mb-4 text-sm h-10 text-text-medium">Compacte et agile, parfaite pour la ville.</p>
                        <div class="flex justify-between items-center mt-4">
                            <p class="text-xl price">300 Dhs <span class="text-sm font-normal text-text-medium">/ jour</span></p>
                            <a href="#reservation" class="btn btn-primary text-xs px-4 py-2 reserve-now-link">Réserver</a>
                        </div>
                    </div>
                </div>
                 <!-- Car Card 4 -->
                 <div class="car-card">
                    <div class="relative group overflow-hidden rounded-t-lg">
                        <img src="https://placehold.co/300x200/e2e8f0/334155?text=Sandero+D" alt="Dacia Sandero Diesel" class="w-full h-52 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl mb-2">Dacia Sandero Diesel</h3>
                        <p class="mb-4 text-sm h-10 text-text-medium">Version diesel économique et polyvalente.</p>
                        <div class="flex justify-between items-center mt-4">
                           <p class="text-xl price">250 Dhs <span class="text-sm font-normal text-text-medium">/ jour</span></p>
                           <a href="#reservation" class="btn btn-primary text-xs px-4 py-2 reserve-now-link">Réserver</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section - Redesigned -->
    <section id="services" class="py-24 bg-gradient-to-br from-primary to-blue-800 text-white section-animate">
        <div class="container mx-auto px-6 text-center">
            <h2 class="section-title mb-4">Nos Engagements Qualité</h2>
            <p class="section-subtitle !text-blue-100 opacity-90">Votre satisfaction est notre priorité.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                <!-- Service Card 1 -->
                <div class="service-card bg-white/10 backdrop-blur-md p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-2 border border-white/10 hover:border-white/20">
                     <div class="text-accent text-6xl mb-6"> <!-- Bigger icon -->
                        <i class="fas fa-plane-departure"></i>
                     </div>
                    <h3 class="text-2xl font-semibold mb-3">Livraison Aéroport</h3>
                    <p class="opacity-90 leading-relaxed">Prise en charge et retour simplifiés directement à l'aéroport d'Agadir Al Massira.</p>
                </div>
                <!-- Service Card 2 -->
                <div class="service-card bg-white/10 backdrop-blur-md p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-2 border border-white/10 hover:border-white/20">
                    <div class="text-accent text-6xl mb-6">
                        <i class="fas fa-headset"></i>
                     </div>
                    <h3 class="text-2xl font-semibold mb-3">Assistance 24/7</h3>
                    <p class="opacity-90 leading-relaxed">Notre équipe est disponible à toute heure pour vous assister en cas de besoin.</p>
                </div>
                <!-- Service Card 3 -->
                <div class="service-card bg-white/10 backdrop-blur-md p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-2 border border-white/10 hover:border-white/20">
                     <div class="text-accent text-6xl mb-6">
                        <i class="fas fa-infinity"></i> <!-- Changed Icon -->
                     </div>
                    <h3 class="text-2xl font-semibold mb-3">Kilométrage Illimité</h3>
                    <p class="opacity-90 leading-relaxed">Explorez sans limites. Profitez pleinement de votre aventure au Maroc.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ Section - Redesigned -->
    <section id="faq" class="py-24 bg-bg-light section-animate">
         <div class="container mx-auto px-6 max-w-4xl"> <!-- Wider container -->
            <h2 class="section-title">Questions Fréquentes</h2>
            <p class="section-subtitle">Trouvez rapidement les informations dont vous avez besoin.</p>
            <div class="space-y-4">
                <details class="group">
                    <summary class="flex justify-between items-center cursor-pointer">
                        <span>Quels documents sont nécessaires pour louer une voiture ?</span>
                        <i class="fas fa-chevron-down text-lg"></i>
                    </summary>
                    <div>Vous aurez besoin d'un permis de conduire valide depuis au moins un an, d'une pièce d'identité (passeport ou carte d'identité nationale en cours de validité), et d'une carte de crédit au nom du conducteur principal pour la caution.</div>
                </details>
                 <details class="group">
                    <summary class="flex justify-between items-center cursor-pointer">
                        <span>Quel est l'âge minimum requis pour louer ?</span>
                        <i class="fas fa-chevron-down text-lg"></i>
                    </summary>
                    <div>L'âge minimum standard est de 21 ans. Cependant, pour certaines catégories de véhicules (luxe, 4x4), un âge minimum plus élevé et/ou des années d'expérience de conduite supplémentaires peuvent être exigés.</div>
                </details>
                 <details class="group">
                    <summary class="flex justify-between items-center cursor-pointer">
                        <span>Quelles assurances sont incluses dans le prix ?</span>
                        <i class="fas fa-chevron-down text-lg"></i>
                    </summary>
                    <div>Nos tarifs incluent toujours l'assurance responsabilité civile obligatoire et une assurance de base couvrant les dommages au véhicule avec une franchise applicable en cas d'accident responsable. Des options d'assurance complémentaire (rachat de franchise, protection personnelle) sont disponibles.</div>
                </details>
                 <details class="group">
                    <summary class="flex justify-between items-center cursor-pointer">
                        <span>Puis-je conduire la voiture en dehors d'Agadir ?</span>
                        <i class="fas fa-chevron-down text-lg"></i>
                    </summary>
                    <div>Absolument ! Nos véhicules peuvent être conduits dans tout le Maroc. Nous vous demandons simplement de nous informer si vous prévoyez de très longs trajets ou de vous rendre dans des zones spécifiques. La sortie du territoire marocain n'est pas autorisée.</div>
                </details>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-24 bg-bg-darker text-white section-animate">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-4xl font-bold mb-6 text-primary">Contactez-Nous</h2>
            <p class="mb-12 max-w-xl mx-auto text-gray-400 text-lg leading-relaxed">Une question ? Besoin d'un devis personnalisé ? Notre équipe est prête à vous aider.</p>
            <div class="flex flex-col md:flex-row justify-center items-center space-y-8 md:space-y-0 md:space-x-12">
                <a href="tel:+212659198122" class="text-xl font-medium hover:text-accent transition duration-300 flex items-center group">
                    <i class="fas fa-phone mr-3 text-accent text-3xl group-hover:scale-110 transition-transform duration-300"></i>
                    <span>+212 659 198 122</span>
                </a>
                <a href="mailto:contact@palacecars.ma" class="text-xl font-medium hover:text-accent transition duration-300 flex items-center group">
                    <i class="fas fa-envelope mr-3 text-accent text-3xl group-hover:scale-110 transition-transform duration-300"></i>
                    <span>contact@palacecars.ma</span>
                </a>
                 <a href="https://wa.me/212659198122" target="_blank" class="text-xl font-medium hover:text-accent transition duration-300 flex items-center group">
                    <i class="fab fa-whatsapp mr-3 text-accent text-3xl group-hover:scale-110 transition-transform duration-300"></i>
                    <span>WhatsApp Direct</span>
                 </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-bg-dark text-gray-400 py-12 border-t border-gray-800">
        <div class="container mx-auto px-6 text-center">
             <div class="mb-6">
                 <a href="#accueil" class="px-3 hover:text-accent text-sm transition duration-300">Accueil</a> |
                 <a href="#reservation" class="px-3 hover:text-accent text-sm transition duration-300 reserve-now-link">Réserver</a> |
                 <a href="#flotte" class="px-3 hover:text-accent text-sm transition duration-300">Flotte</a> |
                 <a href="#services" class="px-3 hover:text-accent text-sm transition duration-300">Services</a> |
                 <a href="#faq" class="px-3 hover:text-accent text-sm transition duration-300">FAQ</a> |
                 <a href="#contact" class="px-3 hover:text-accent text-sm transition duration-300">Contact</a>
             </div>
             <!-- Logo de pied de page (Coloré) -->
             <img src="https://i.imgur.com/htqH0IE.png" alt="Palace Cars Logo Footer" class="h-14 w-14 mx-auto mb-5 rounded-full shadow-lg border-2 border-gray-700">
            <p class="text-sm">&copy; <span id="current-year"></span> PalaceCars - Tous droits réservés. Location de voiture Agadir.</p>
             <p class="text-xs mt-3 text-gray-500">Design & Développement</p>
        </div>
    </footer>


    <!-- Script Firebase & Logique -->
    <script type="module">
        // --- Importations Firebase ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, where, getDoc, getDocs, Timestamp, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyCsPHf_v8-gEiWGQzkwses-jOiDXs9tvWo",
            authDomain: "palace-cars.firebaseapp.com",
            projectId: "palace-cars",
            storageBucket: "palace-cars.firebasestorage.app",
            messagingSenderId: "469852272715",
            appId: "1:469852272715:web:6e87dc7083cdc04e03b5ce",
            measurementId: "G-KCEF4WBW0G"
        };

        // --- Initialisation Firebase ---
        let db;
        let bookingsCollectionRef;
        let unavailabilityPeriodsCollectionRef;
        let carManualStatusCollectionRef;
        let dbReady = false;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            bookingsCollectionRef = collection(db, "palace_cars_bookings");
            unavailabilityPeriodsCollectionRef = collection(db, "car_unavailability_periods");
            carManualStatusCollectionRef = collection(db, "car_manual_status");
            dbReady = true;
            console.log("Firebase initialisé avec succès.");
        } catch (error) {
            console.error("Erreur critique d'initialisation Firebase:", error);
             const initialMessageBox = document.getElementById('message-box');
             const reservationSectionEl = document.getElementById('reservation');
             if(initialMessageBox && reservationSectionEl) {
                 toggleReservationForm(true, false); // Force l'ouverture pour montrer l'erreur
                 showMessage("Erreur critique: Impossible de connecter à la base de données.", "error");
             }
        }

         // --- Données Voitures ---
         const carFleet = {
            "Dacia Logan Diesel 2024": { price: 250, image: "https://placehold.co/300x200/e2e8f0/334155?text=Logan+D+24" },
            "Dacia Logan Diesel 2025": { price: 250, image: "https://placehold.co/300x200/e2e8f0/334155?text=Logan+D+25" },
            "Dacia Sandero Essence": { price: 300, image: "https://placehold.co/300x200/e2e8f0/334155?text=Sandero+E" },
            "Dacia Sandero Diesel": { price: 250, image: "https://placehold.co/300x200/e2e8f0/334155?text=Sandero+D" },
        };
        const carNames = Object.keys(carFleet);

        // --- Références DOM ---
        const mainHeader = document.getElementById('main-header');
        const reservationSection = document.getElementById('reservation');
        const reservationWrapper = document.getElementById('reservation-inner-wrapper');
        const form = document.getElementById('booking-form');
        const messageBox = document.getElementById('message-box');
        const checkAvailabilityButton = document.getElementById('check-availability-button');
        const availabilitySpinner = document.getElementById('availability-spinner');
        const availableCarsSection = document.getElementById('available-cars-section');
        const availableCarsListDiv = document.getElementById('available-cars-list');
        const noCarsMessage = document.getElementById('no-cars-message');
        const submitBookingButton = document.getElementById('submit-booking-button');
        const submitSpinner = document.getElementById('submit-spinner');
        const selectedCarInput = document.getElementById('selectedCar');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const currentYearSpan = document.getElementById('current-year');
        const datePriseEnChargeInput = document.getElementById('datePriseEnCharge');
        const heurePriseEnChargeHeureSelect = document.getElementById('heurePriseEnChargeHeure');
        const heurePriseEnChargeMinuteSelect = document.getElementById('heurePriseEnChargeMinute');
        const dateRetourInput = document.getElementById('dateRetour');
        const heureRetourHeureSelect = document.getElementById('heureRetourHeure');
        const heureRetourMinuteSelect = document.getElementById('heureRetourMinute');

        let selectedCarName = null;
        let currentPickupDateTime = null;
        let currentReturnDateTime = null;

        // --- Fonctions Utilitaires ---
        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.className = 'p-4 rounded-lg text-center mb-6 font-medium border text-sm md:text-base'; // Classes de base
            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'border-green-300', 'text-green-800');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'border-red-300', 'text-red-800');
            } else if (type === 'warning') {
                 messageBox.classList.add('bg-yellow-100', 'border-yellow-300', 'text-yellow-800');
            } else { // info
                messageBox.classList.add('bg-blue-100', 'border-blue-300', 'text-blue-800');
            }
             messageBox.style.opacity = '1';
             messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.style.opacity = '0';
                setTimeout(() => messageBox.classList.add('hidden'), 300);
            }, 7000);
        }

        function getDateTimeObject(dateStr, hourStr, minuteStr) {
            if (!dateStr || hourStr === "" || minuteStr === "") return null;
            try {
                const hour = hourStr.padStart(2, '0');
                const minute = minuteStr.padStart(2, '0');
                // Crée la date en UTC pour des comparaisons fiables
                const d = new Date(Date.UTC(
                    parseInt(dateStr.substring(0, 4)), 
                    parseInt(dateStr.substring(5, 7)) - 1, // Mois est 0-indexé
                    parseInt(dateStr.substring(8, 10)), 
                    parseInt(hour), 
                    parseInt(minute), 0
                ));
                if (isNaN(d.getTime())) { throw new Error("Date invalide"); }
                return d;
            } catch (e) {
                console.error("Erreur conversion date/heure:", dateStr, hourStr, minuteStr, e);
                showMessage("Erreur dans le format de date ou d'heure.", "error");
                return null;
            }
        }

        function formatReadableDateTime(dateObj) {
            if (!dateObj || isNaN(dateObj.getTime())) return "Date invalide";
             const options = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' };
             try {
                let formatted = new Intl.DateTimeFormat('fr-FR', options).format(dateObj);
                formatted = formatted.replace(/[\s,]+/g, ' ').trim();
                return formatted;
             } catch (e) {
                const day = String(dateObj.getUTCDate()).padStart(2, '0');
                const month = String(dateObj.getUTCMonth() + 1).padStart(2, '0');
                const year = dateObj.getUTCFullYear();
                const hours = String(dateObj.getUTCHours()).padStart(2, '0');
                const minutes = String(dateObj.getUTCMinutes()).padStart(2, '0');
                return `${day}/${month}/${year} ${hours}h${minutes}`;
             }
        }

        function populateTimeSelects() {
            const hourSelects = [heurePriseEnChargeHeureSelect, heureRetourHeureSelect];
            const minuteSelects = [heurePriseEnChargeMinuteSelect, heureRetourMinuteSelect];

            hourSelects.forEach(select => {
                const placeholder = select.querySelector('option[disabled]'); 
                select.innerHTML = ''; 
                if (placeholder) select.appendChild(placeholder);
                for (let i = 0; i < 24; i++) { 
                    const value = i.toString().padStart(2, '0'); 
                    select.options.add(new Option(value, value)); 
                }
            });

            minuteSelects.forEach(select => {
                 const placeholder = select.querySelector('option[disabled]'); 
                 select.innerHTML = ''; 
                 if (placeholder) select.appendChild(placeholder);
                 ['00', '15', '30', '45'].forEach(value => {
                     select.options.add(new Option(value, value));
                 });
            });
        }

        // --- Fonction de Vérification de Disponibilité (Optimisée) ---
        // Cette fonction est appelée par checkAvailabilityButton ET submitBookingButton
        async function isCarAvailable(carName, pickupDateTime, returnDateTime) {
             if (!dbReady || !carName || !pickupDateTime || !returnDateTime || isNaN(pickupDateTime) || isNaN(returnDateTime)) {
                 console.error("Données invalides pour isCarAvailable", carName, pickupDateTime, returnDateTime);
                 return { available: false, reason: 'Erreur interne' };
             }
             try {
                 // 1. Vérifier statut manuel (prioritaire)
                 const manualStatusDocRef = doc(db, "car_manual_status", carName);
                 const manualStatusSnap = await getDoc(manualStatusDocRef);
                 if (manualStatusSnap.exists() && manualStatusSnap.data().status === 'unavailable') {
                     return { available: false, reason: 'Indisponible' };
                 }

                 // 2. Vérifier les périodes d'indisponibilité (Requête optimisée)
                 const pickupTimestamp = Timestamp.fromDate(pickupDateTime);
                 const returnTimestamp = Timestamp.fromDate(returnDateTime);

                 // Requête : Trouver les périodes pour cette voiture qui se terminent APRES le début de ma demande
                 const qPeriodsEndAfterPickup = query(
                     unavailabilityPeriodsCollectionRef,
                     where("car", "==", carName),
                     where("endDate", ">", pickupTimestamp)
                 );

                 const periodsSnapshot = await getDocs(qPeriodsEndAfterPickup);
                 let isUnavailable = false;
                 let reason = "(Indisponible)";

                 for (const docSnap of periodsSnapshot.docs) {
                     const period = docSnap.data();
                     // Si une période trouvée commence AVANT la fin de ma demande, il y a chevauchement
                     if (period.startDate && period.startDate.seconds < returnTimestamp.seconds) {
                         isUnavailable = true;
                         // Si la période n'est PAS de type 'maintenance', afficher la date de dispo
                         if (period.type !== 'maintenance' && period.endDate) { 
                            reason = `(Disponible le ${formatReadableDateTime(period.endDate.toDate())})`;
                         }
                         break;
                     }
                 }

                 if (isUnavailable) {
                     console.log(`${carName} a une période d'indisponibilité qui chevauche la demande.`);
                     return { available: false, reason: reason };
                 }
                 return { available: true }; // La voiture est disponible

             } catch (error) {
                 console.error(`Erreur vérification disponibilité pour ${carName}:`, error);
                 if (error.code === 'failed-precondition' && error.message.includes('index')) {
                     // Cette erreur est NORMALE si l'index n'est pas créé.
                     showMessage(`Index Firestore manquant. Ouvrez la console (F12) et suivez le lien pour créer l'index: ${error.message}`, "error");
                 } else { 
                     showMessage("Erreur technique lors de la vérification de disponibilité.", "error"); 
                 }
                 return { available: false, reason: 'Erreur' };
             }
         }

        // --- Logique de Vérification de Disponibilité (Bouton Principal) ---
        checkAvailabilityButton.addEventListener('click', async () => {
             // ... (Validation des champs) ...
             if (!dbReady) { showMessage("La base de données n'est pas prête. Réessayez.", "error"); return; }
             const startDateStr = datePriseEnChargeInput.value; const startHourStr = heurePriseEnChargeHeureSelect.value;
             const startMinuteStr = heurePriseEnChargeMinuteSelect.value; const endDateStr = dateRetourInput.value;
             const endHourStr = heureRetourHeureSelect.value; const endMinuteStr = heureRetourMinuteSelect.value;
             if (!startDateStr || startHourStr === "" || startMinuteStr === "" || !endDateStr || endHourStr === "" || endMinuteStr === "") { showMessage("Veuillez sélectionner les dates et heures complètes.", "warning"); return; }
             currentPickupDateTime = getDateTimeObject(startDateStr, startHourStr, startMinuteStr);
             currentReturnDateTime = getDateTimeObject(endDateStr, endHourStr, endMinuteStr);
             if (!currentPickupDateTime || !currentReturnDateTime) { return; } 
             const now = new Date();
             const todayStart = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()));
              if (currentPickupDateTime < todayStart) { showMessage("La date de prise en charge ne peut pas être dans le passé.", "warning"); return; }
              if (currentPickupDateTime >= currentReturnDateTime) { showMessage("La date/heure de fin doit être après la date/heure de début.", "warning"); return; }

             availabilitySpinner.classList.remove('hidden'); checkAvailabilityButton.disabled = true;
             availableCarsSection.classList.add('hidden'); availableCarsListDiv.innerHTML = '';
             noCarsMessage.classList.add('hidden'); submitBookingButton.classList.add('hidden');
             selectedCarName = null; selectedCarInput.value = ''; messageBox.classList.add('hidden');

             try {
                 let availableCarsCount = 0;
                 // 1. Get all manual statuses
                 const manualStatusesSnap = await getDocs(carManualStatusCollectionRef);
                 const manualStatusMap = new Map();
                 manualStatusesSnap.forEach(doc => { manualStatusMap.set(doc.id, doc.data().status); });

                 // 2. Get all relevant unavailability periods (Requête optimisée)
                 const returnTimestamp = Timestamp.fromDate(currentReturnDateTime);
                 const pickupTimestamp = Timestamp.fromDate(currentPickupDateTime);

                 const qPeriodsEndAfterPickup = query(
                     unavailabilityPeriodsCollectionRef,
                     where("endDate", ">", pickupTimestamp)
                 );

                 const periodsSnapshot = await getDocs(qPeriodsEndAfterPickup);
                 const unavailabilityMap = new Map(); // Map<carName, String (reason)>

                 periodsSnapshot.forEach(doc => {
                     const period = doc.data();
                     // Check for overlap
                     if (period.startDate && period.startDate.seconds < returnTimestamp.seconds) {
                         let reason = "(Indisponible)";
                         if (period.type !== 'maintenance' && period.endDate) {
                            reason = `(Disponible le ${formatReadableDateTime(period.endDate.toDate())})`;
                         }
                         unavailabilityMap.set(period.car, reason);
                     }
                 });

                 // 3. Loop through car list and check status
                 availableCarsListDiv.innerHTML = '';
                 carNames.forEach((carName) => {
                     let isAvailable = true; let reason = "";
                     if (manualStatusMap.get(carName) === 'unavailable') {
                         isAvailable = false; reason = '(Indisponible)';
                     } else if (unavailabilityMap.has(carName)) {
                         isAvailable = false;
                         reason = unavailabilityMap.get(carName);
                     }
                     
                     const carData = carFleet[carName];
                     availableCarsListDiv.appendChild(createCarCard(carName, carData, isAvailable, reason));
                     if (isAvailable) { availableCarsCount++; }
                 });

                 availableCarsSection.classList.remove('hidden');
                 noCarsMessage.classList.toggle('hidden', availableCarsCount === 0);
                 availableCarsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

             } catch (error) {
                 console.error("Erreur globale lors de la vérification:", error);
                 if (error.code === 'failed-precondition' && error.message.includes('index')) {
                    showMessage(`Index Firestore manquant. Ouvrez la console (F12) et suivez le lien pour créer l'index: ${error.message}`, "error");
                 } else { showMessage("Une erreur s'est produite lors de la vérification. Veuillez réessayer.", "error"); }
             } finally {
                 availabilitySpinner.classList.add('hidden'); checkAvailabilityButton.disabled = false;
             }
        });

        // --- Création Carte Voiture ---
         function createCarCard(carName, carData, isAvailable, unavailableReason = "(Indisponible)") {
            const card = document.createElement('div');
            const availabilityClasses = isAvailable ? 'cursor-pointer group' : 'opacity-60 cursor-not-allowed';
            card.className = `car-card ${availabilityClasses} shadow-lg hover:shadow-primary/20`;
            card.dataset.carName = carName;

            card.innerHTML = `
                <div class="relative overflow-hidden rounded-t-lg">
                    <img src="${carData.image || 'https://placehold.co/300x200/e2e8f0/cbd5e0?text=Image+Voiture'}" alt="${carName}" class="w-full h-52 object-cover ${isAvailable ? 'group-hover:scale-110' : ''} transition-transform duration-500 ease-in-out" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                    ${!isAvailable ? `<div class="absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center rounded-t-lg"><span class="text-white font-semibold text-sm px-3 py-1 rounded bg-red-600 shadow">${unavailableReason}</span></div>` : ''}
                    <div class="absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-black/60 to-transparent pointer-events-none"></div>
                </div>
                <div class="p-6">
                    <h4 class="text-xl font-bold text-text-dark mb-2 truncate">${carName}</h4>
                    <div class="flex justify-between items-center mb-5">
                         <p class="text-2xl font-extrabold text-primary price">${carData.price}<span class="text-sm font-medium text-text-medium"> Dhs/jour</span></p>
                    </div>
                    <button type="button" class="select-car-button btn w-full ${isAvailable ? 'btn-primary' : 'bg-gray-400 text-gray-700 cursor-not-allowed'} text-sm py-3" ${!isAvailable ? 'disabled' : ''}>
                        <span class="button-text">${isAvailable ? 'Sélectionner' : 'Indisponible'}</span>
                        ${isAvailable ? '<i class="fas fa-check ml-1 icon-check hidden"></i>' : ''}
                    </button>
                </div>
            `;

             if (isAvailable) {
                 const selectButton = card.querySelector('.select-car-button');
                 const buttonText = selectButton.querySelector('.button-text');
                 const checkIcon = selectButton.querySelector('.icon-check');

                 // Gérer le clic sur la carte ou le bouton
                 card.addEventListener('click', (e) => {
                     // Gérer la sélection
                     document.querySelectorAll('.car-card.selected').forEach(selectedCard => {
                         selectedCard.classList.remove('selected', 'border-2');
                         const btn = selectedCard.querySelector('.select-car-button');
                         if (btn) {
                            btn.querySelector('.button-text').textContent = 'Sélectionner';
                            btn.querySelector('.icon-check')?.classList.add('hidden');
                            btn.classList.remove('bg-green-600', 'hover:bg-green-700', 'cursor-not-allowed', 'selected-btn', 'text-white');
                            btn.classList.add('btn-primary');
                            btn.disabled = false;
                         }
                     });
                     card.classList.add('selected', 'border-2');
                     buttonText.textContent = 'Sélectionnée';
                     checkIcon?.classList.remove('hidden');
                     selectButton.classList.remove('btn-primary');
                     selectButton.classList.add('bg-green-600', 'hover:bg-green-700', 'cursor-not-allowed', 'selected-btn', 'text-white');
                     selectButton.disabled = true; 
                     selectedCarName = carName;
                     selectedCarInput.value = carName;
                     submitBookingButton.classList.remove('hidden');
                     submitBookingButton.disabled = false; submitSpinner.classList.add('hidden');
                 });
             }
            return card;
         }


        // --- Logique de Soumission Finale ---
        submitBookingButton.addEventListener('click', async () => {
             console.log("Submit button clicked"); 
              if (!dbReady) {
                  console.error("DB not ready during submit");
                  showMessage("La connexion à la base de données n'est pas prête.", "error");
                  return;
              }
             if (!selectedCarName) { showMessage("Veuillez d'abord sélectionner une voiture.", "warning"); return; }
             if (!currentPickupDateTime || !currentReturnDateTime) { showMessage("Dates invalides. Revérifiez la disponibilité.", "warning"); return; }
             console.log("Validation passed, gathering data..."); 

             const formData = new FormData(form);
             const bookingData = Object.fromEntries(formData.entries());
             const requiredFields = ['nomPrenom', 'telephone', 'email', 'lieuPriseEnCharge', 'lieuRetour', 'datePriseEnCharge', 'heurePriseEnChargeHeure', 'heurePriseEnChargeMinute', 'dateRetour', 'heureRetourHeure', 'heureRetourMinute'];
             let firstEmptyField = null;
             let formIsValid = true;
             for (const field of requiredFields) {
                 if (!bookingData[field] || bookingData[field] === "") {
                    formIsValid = false;
                    let label = document.querySelector(`label[for='${field}']`)?.textContent?.replace('*','').trim() || field;
                    if (field.includes('Heure')) label = field.includes('PriseEnCharge') ? 'Heure Début' : 'Heure Fin';
                    if (field.includes('Minute')) label = field.includes('PriseEnCharge') ? 'Minute Début' : 'Minute Fin';
                    showMessage(`Le champ "${label}" est requis.`, 'warning');
                    if (!firstEmptyField) firstEmptyField = document.getElementById(field);
                 }
             }
             if (!formIsValid) {
                 if (firstEmptyField) firstEmptyField.focus();
                 return;
             }
             console.log("Form data valid, proceeding..."); 

             submitBookingButton.disabled = true; submitSpinner.classList.remove('hidden'); messageBox.classList.add('hidden');

             // *** FINAL AVAILABILITY CHECK ***
             console.log(`Checking final availability for ${selectedCarName}...`); 
             const availabilityCheck = await isCarAvailable(selectedCarName, currentPickupDateTime, currentReturnDateTime);
             console.log("Availability check result:", availabilityCheck); 

             if (!availabilityCheck.available) {
                 showMessage(`Désolé, la voiture "${selectedCarName}" vient d'être indisponible. Veuillez choisir une autre voiture.`, 'error');
                  checkAvailabilityButton.click();
                 submitBookingButton.classList.add('hidden'); 
                 submitBookingButton.disabled = false; submitSpinner.classList.add('hidden');
                 console.log("Car became unavailable, submission cancelled."); 
                 return;
             }
             // *** END FINAL CHECK ***

             console.log("Car is still available, preparing details..."); 

             const heurePriseStr = `${bookingData.heurePriseEnChargeHeure.padStart(2, '0')}:${bookingData.heurePriseEnChargeMinute.padStart(2, '0')}`;
             const heureRetourStr = `${bookingData.heureRetourHeure.padStart(2, '0')}:${bookingData.heureRetourMinute.padStart(2, '0')}`;
             const bookingDetails = {
                 nomPrenom: bookingData.nomPrenom, telephone: bookingData.telephone, email: bookingData.email, lieuPriseEnCharge: bookingData.lieuPriseEnCharge, lieuRetour: bookingData.lieuRetour, datePriseEnCharge: bookingData.datePriseEnCharge, heurePriseEnCharge: heurePriseStr, dateRetour: bookingData.dateRetour, heureRetour: heureRetourStr,
                 voiture: selectedCarName, timestamp: serverTimestamp(), confirmed: false, deleted: false
             };
             console.log("Booking details object:", bookingDetails); 

             let newBookingId = null;
             // 1. Save to Firestore
             try {
                 console.log("Attempting to save booking to Firestore..."); 
                 const docRef = await addDoc(bookingsCollectionRef, bookingDetails);
                 newBookingId = docRef.id;
                 console.log("Booking saved to Firestore, ID: ", newBookingId); 

                 // Automatically add unavailability period for this booking
                 const unavailabilityData = {
                    car: selectedCarName,
                    startDate: Timestamp.fromDate(currentPickupDateTime),
                    endDate: Timestamp.fromDate(currentReturnDateTime),
                    type: 'booking', // Mark as automatically generated
                    bookingId: newBookingId // Link to the booking document
                 };
                 console.log("Attempting to add unavailability period to Firestore..."); 
                 await addDoc(unavailabilityPeriodsCollectionRef, unavailabilityData);
                 console.log("Unavailability period added automatically for", selectedCarName); 

             } catch (error) {
                 console.error("Erreur Firestore lors de l'enregistrement: ", error); 
                 showMessage("Erreur technique lors de l'enregistrement de la réservation. Veuillez réessayer.", 'error');
                 submitBookingButton.disabled = false; submitSpinner.classList.add('hidden');
                 return;
             }

             // 2. Send via Web3Forms
             try {
                 console.log("Attempting to send email via Web3Forms..."); 
                 const objectForWeb3Forms = { ...bookingDetails };
                 objectForWeb3Forms.access_key = form.querySelector('input[name="access_key"]').value;
                 objectForWeb3Forms.subject = form.querySelector('input[name="subject"]').value;
                 objectForWeb3Forms.from_name = form.querySelector('input[name="from_name"]').value;
                 objectForWeb3Forms.redirect = form.querySelector('input[name="redirect"]').value;
                 objectForWeb3Forms.datePriseEnCharge = `${bookingDetails.datePriseEnCharge} ${bookingDetails.heurePriseEnCharge}`;
                 objectForWeb3Forms.dateRetour = `${bookingDetails.dateRetour} ${bookingDetails.heureRetour}`;
                 objectForWeb3Forms.timestamp_readable = formatReadableDateTime(new Date()); 
                 delete objectForWeb3Forms.timestamp; 
                 delete objectForWeb3Forms.confirmed; delete objectForWeb3Forms.deleted; delete objectForWeb3Forms.heurePriseEnCharge; delete objectForWeb3Forms.heureRetour; 

                 const jsonPayload = JSON.stringify(objectForWeb3Forms);
                 console.log("Web3Forms Payload:", jsonPayload); 
                 const web3Response = await fetch("https://api.web3forms.com/submit", { method: "POST", headers: { "Content-Type": "application/json", "Accept": "application/json" }, body: jsonPayload });
                 const result = await web3Response.json();
                 if (result.success) {
                     console.log('Web3Forms Success:', result); 
                     showMessage("Demande Envoyée avec Succès ! On va vous contacter le plus proche possible pour la confirmation.", 'success');
                     form.reset();
                      heurePriseEnChargeHeureSelect.value = ""; heurePriseEnChargeMinuteSelect.value = "";
                      heureRetourHeureSelect.value = ""; heureRetourMinuteSelect.value = "";
                     availableCarsSection.classList.add('hidden'); submitBookingButton.classList.add('hidden');
                     selectedCarName = null; selectedCarInput.value = '';
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                 } else {
                     console.error('Web3Forms Error:', result); 
                     showMessage("Demande enregistrée, mais l'e-mail de notification a échoué. Nous vous contacterons quand même.", 'warning');
                     form.reset();
                     heurePriseEnChargeHeureSelect.value = ""; heurePriseEnChargeMinuteSelect.value = "";
                     heureRetourHeureSelect.value = ""; heureRetourMinuteSelect.value = "";
                     availableCarsSection.classList.add('hidden'); submitBookingButton.classList.add('hidden');
                     selectedCarName = null; selectedCarInput.value = '';
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                 }
             } catch (web3Error) {
                 console.error('Erreur fetch Web3Forms:', web3Error); 
                 showMessage("Demande enregistrée, mais l'e-mail de notification a échoué. Nous vous contacterons quand même.", 'warning');
                 form.reset();
                 heurePriseEnChargeHeureSelect.value = ""; heurePriseEnChargeMinuteSelect.value = "";
                 heureRetourHeureSelect.value = ""; heureRetourMinuteSelect.value = "";
                 availableCarsSection.classList.add('hidden'); submitBookingButton.classList.add('hidden');
                 selectedCarName = null; selectedCarInput.value = '';
                 window.scrollTo({ top: 0, behavior: 'smooth' });
             } finally {
                 submitBookingButton.disabled = false; submitSpinner.classList.add('hidden');
             }
        });

        // --- Header Scroll Effect ---
        window.addEventListener('scroll', () => {
             const scrollPosition = window.scrollY;
             if (scrollPosition > 50) {
                 mainHeader.classList.add('scrolled');
             } else {
                 mainHeader.classList.remove('scrolled');
             }
        });

        // --- Mobile Menu Toggle ---
        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', (e) => { e.stopPropagation(); mobileMenu.classList.toggle('hidden'); });
             document.addEventListener('click', (e) => {
                if (!mobileMenu.contains(e.target) && !mobileMenuButton.contains(e.target)) {
                    mobileMenu.classList.add('hidden');
                }
            });
            mobileMenu.querySelectorAll('a').forEach(link => { link.addEventListener('click', () => { mobileMenu.classList.add('hidden'); }); });
        }

        // --- Footer Current Year ---
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

        // --- Function to show/hide reservation form with animation (CORRECTED LOGIC) ---
        function toggleReservationForm(show, doScroll = true) {
            if (!reservationSection || !reservationWrapper) {
                console.error("Section réservation ou wrapper non trouvé !");
                return;
            }

            if (show) {
                // Rendre visible
                reservationSection.style.display = 'block'; // Assurer qu'il n'est pas en display:none
                
                // Forcer un reflow (important pour que la transition se lance)
                void reservationSection.offsetWidth; 

                // Appliquer les classes pour l'état visible
                reservationSection.classList.add('max-h-[3000px]', 'opacity-100');
                reservationSection.classList.remove('max-h-0', 'opacity-0', 'p-0', 'm-0', 'overflow-hidden');
                reservationWrapper.classList.add('my-16', 'md:my-24');
                
                if (doScroll) {
                    setTimeout(() => {
                        reservationSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 50); 
                }
            } else {
                 // Cacher
                 reservationSection.classList.remove('max-h-[3000px]', 'opacity-100');
                 reservationSection.classList.add('max-h-0', 'opacity-0', 'p-0', 'm-0', 'overflow-hidden');
                 reservationWrapper.classList.remove('my-16', 'md:my-24');
            }
        }

        // --- Event Listeners for showing the form ---
         const reservationTriggers = [
             document.getElementById('hero-reserve-button'),
             document.getElementById('scroll-down-button'),
             document.getElementById('nav-reserve-button'),
             document.getElementById('mobile-reserve-button'),
             ...document.querySelectorAll('.reserve-now-link')
         ];

         reservationTriggers.forEach(trigger => {
            if(trigger) { 
                trigger.addEventListener('click', (event) => {
                    event.preventDefault();
                    console.log("Trigger 'Réserver en Ligne' cliqué."); // Log de débogage
                    toggleReservationForm(true); // Montrer et défiler
                });
            }
         });


        // --- Initialize time selects and hide reservation section on load ---
        document.addEventListener('DOMContentLoaded', () => {
             populateTimeSelects();
             
             if (reservationSection) {
                // Appliquer les classes initiales pour cacher
                reservationSection.classList.add('max-h-0', 'opacity-0', 'overflow-hidden', 'p-0', 'm-0');
                // S'assurer que les classes de visibilité sont absentes
                reservationSection.classList.remove('max-h-[3000px]', 'opacity-100');
                if(reservationWrapper) {
                    reservationWrapper.classList.remove('my-16', 'md:my-24');
                }
                // Important : doit être 'block' pour que max-height fonctionne, mais 'hidden'
                reservationSection.style.display = 'block'; 
             } else {
                console.error("Reservation section element not found on DOMContentLoaded");
             }
             
            // --- Section Animations on Scroll ---
            const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
            const observerCallback = (entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Ne pas animer la section de réservation au scroll si elle est cachée
                        if (entry.target.id === 'reservation' && !entry.target.classList.contains('opacity-100')) {
                            // Ne pas l'animer, mais la retirer de l'observation
                            observer.unobserve(entry.target);
                            return; 
                        }
                        entry.target.classList.add('visible'); 
                        observer.unobserve(entry.target);
                    }
                });
            };

            const observer = new IntersectionObserver(observerCallback, observerOptions);
            document.querySelectorAll('.section-animate').forEach(section => {
                 observer.observe(section);
            });
             if(reservationSection) observer.observe(reservationSection);
        });

    </script>
</body>
</html>

