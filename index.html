<!DOCTYPE html>
<!-- Attributs lang et dir gérés par JS -->
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le titre sera défini par JS -->
    <title data-key="siteTitle">Palace Cars - Location de Voiture Agadir</title>
    <!-- FAVICON (Logo en couleur) -->
    <link rel="icon" href="https://i.imgur.com/htqH0IE.png" type="image/png">
    <link rel="apple-touch-icon" href="https://i.imgur.com/htqH0IE.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome (CORRECTION de 'xintegrity' en 'integrity') -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMDJd4qFf3F5f5qK2K6Q24L+nkA5bf5F3Gmf0iVCi/2fA/wz2N9H/Gz9oW9sP7Cg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- PAS de script Google Translate -->
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f1f5f9; /* Slate-100 */ color: #334155; /* Slate-700 */ scroll-behavior: smooth; overflow-x: hidden; /* Prevent horizontal scroll */ }
        /* Custom Colors: Blue (#2563eb) and Yellow/Gold (#f59e0b) */
        :root {
            --color-primary: #2563eb; /* Blue-600 */
            --color-primary-dark: #1d4ed8; /* Blue-700 */
            --color-primary-light: #60a5fa; /* Blue-400 */
            --color-primary-lighter: #eff6ff; /* Blue-50 */
            --color-accent: #f59e0b; /* Amber-500 */
            --color-accent-dark: #d97706; /* Amber-600 */
            --color-text-dark: #1e293b; /* Slate-800 */
            --color-text-medium: #64748b; /* Slate-500 */
            --color-text-light: #f1f5f9; /* Slate-100 */
            --color-bg-light: #f1f5f9; /* Slate-100 */
            --color-bg-white: #ffffff;
            --color-bg-dark: #0f172a; /* Slate-900 */
            --color-bg-darker: #020617; /* Slate-950 */
            --color-border-light: #e2e8f0; /* Slate-200 */
            --color-border-medium: #cbd5e1; /* Slate-300 */
        }
                
        /* Keyframe Animations */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeInUp 0.6s ease-out forwards; }
        .animate-fade-in-down { animation: fadeInDown 0.6s ease-out forwards; }

        /* Helper classes */
        .text-primary { color: var(--color-primary); }
        .bg-primary { background-color: var(--color-primary); }
        .hover\:bg-primary-dark:hover { background-color: var(--color-primary-dark); }
        .border-primary { border-color: var(--color-primary); }
        .ring-primary { --tw-ring-color: var(--color-primary); }
        .focus\:border-primary:focus { border-color: var(--color-primary); }
        .focus\:ring-primary:focus { --tw-ring-color: var(--color-primary); }

        .text-accent { color: var(--color-accent); }
        .bg-accent { background-color: var(--color-accent); }
        .hover\:bg-accent-dark:hover { background-color: var(--color-accent-dark); }
        .border-accent { border-color: var(--color-accent); }
        .ring-accent { --tw-ring-color: var(--color-accent); }
        .focus\:border-accent:focus { border-color: var(--color-accent); }
        .focus\:ring-accent:focus { --tw-ring-color: var(--color-accent); }

        /* Header Styling */
        header { transition: background-color 0.3s ease, box-shadow 0.3s ease, padding 0.3s ease; }
        header.scrolled { background-color: var(--color-bg-white); box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding-top: 0.5rem; padding-bottom: 0.5rem; } /* py-2 */
        header nav a { transition: color 0.3s ease; }
        /* Style pour les liens et le nouveau bouton de langue */
        header:not(.scrolled) nav a:not(.btn-accent),
        header:not(.scrolled) #lang-menu-button { 
            color: white; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.3); 
        }
        header:not(.scrolled) nav a:not(.btn-accent):hover,
        header:not(.scrolled) #lang-menu-button:hover { 
            color: var(--color-accent); 
        } 
        header:not(.scrolled) #mobile-menu-button { color: white; }
                
        header.scrolled nav a,
        header.scrolled #lang-menu-button { 
            color: var(--color-text-dark); 
        } 
        header.scrolled nav a:hover,
        header.scrolled #lang-menu-button:hover { 
            color: var(--color-primary); 
        }
        header.scrolled #mobile-menu-button { color: var(--color-text-dark); }

        #mobile-menu { background-color: var(--color-bg-white); }
        #mobile-menu a { color: var(--color-text-dark); }
        #mobile-menu a:hover:not(.lang-option) { background-color: var(--color-primary-lighter); color: var(--color-primary); }
        #mobile-menu .lang-option:hover { color: var(--color-primary); }

        /* Logo swap styling */
        .logo-container { 
            position: relative; 
            /* Taille initiale large */
            width: 6rem; /* h-24 */
            height: 6rem; /* w-24 */
            transition: width 0.3s ease, height 0.3s ease; 
        } 
        /* Au scroll, logo plus petit */
        header.scrolled .logo-container { 
            width: 4rem; /* h-16 */ 
            height: 4rem; /* w-16 */
        }

        .logo-container img {
            position: absolute; top: 0; left: 0;
            height: 100%; width: 100%;
            object-fit: contain;
            border-radius: 9999px; /* rounded-full */
            transition: opacity 0.3s ease-in-out;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); /* shadow-md */
        }

        /* Logic for logo swap (Desktop) */
        #logo-desktop-color { opacity: 0; }
        #logo-desktop-white { opacity: 1; }
        header.scrolled #logo-desktop-color { opacity: 1; }
        header.scrolled #logo-desktop-white { opacity: 0; }
                
        /* Logic for logo swap (Mobile) */
        #logo-mobile-color { opacity: 0; }
        #logo-mobile-white { opacity: 1; }
        header.scrolled #logo-mobile-color { opacity: 1; }
        header.scrolled #logo-mobile-white { opacity: 0; }

        /* Hero Section Styling */
        .hero-bg {
            background-image: linear-gradient(rgba(10, 20, 80, 0.6), rgba(0, 0, 0, 0.8)), url('https://i.imgur.com/2vH1UUR.jpeg');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed; /* Parallax effect */
        }
        .text-shadow-lg { text-shadow: 0 4px 8px rgba(0,0,0,0.5); }

        /* Loader */
        .loader { border-top-color: var(--color-primary); animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Card styles - More Dynamic & Premium */
        .car-card { transition: transform 0.3s ease, box-shadow 0.4s ease; background-color: var(--color-bg-white); border-radius: 1rem; /* rounded-2xl */ overflow: hidden; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -4px rgba(0,0,0,0.07); }
        .car-card img { transition: transform 0.5s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .car-card:hover { transform: translateY(-12px); box-shadow: 0 25px 50px -12px rgba(37, 99, 235, 0.25); } /* Primary color shadow */
        .car-card:hover img { transform: scale(1.1); }
        .car-card.selected { border: 2px solid var(--color-primary); box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.3), 0 10px 20px rgba(0,0,0,0.1); transform: scale(1.03); }
        .car-card h3, .car-card h4 { color: var(--color-text-dark); font-weight: 700; } /* Bold */
        .car-card p { color: var(--color-text-medium); }
        .car-card .price { color: var(--color-primary); font-weight: 700; font-size: 1.375rem; } /* Increased price size */
        .car-card .select-car-button { font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s ease; border-radius: 9999px; /* rounded-full */ box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .car-card .select-car-button:hover:not(:disabled) { transform: translateY(-3px) scale(1.03); box-shadow: 0 10px 15px rgba(0,0,0,0.15); }
        .car-card .select-car-button.selected-btn { background-color: #16a34a; box-shadow: 0 4px 10px rgba(22, 163, 74, 0.3); } /* Green-600 */
        .car-card .select-car-button.selected-btn:hover { background-color: #15803d; box-shadow: 0 6px 12px rgba(21, 128, 61, 0.4); } /* Green-700 */

        /* Input/Select Styles - Modernized */
        input[type="text"], input[type="tel"], input[type="email"], input[type="date"], select {
            background-color: var(--color-bg-white); border: 1px solid var(--color-border-medium); color: var(--color-text-dark);
            border-radius: 0.75rem; /* rounded-xl */ padding: 1rem 1.25rem; transition: border-color 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04) inset; font-weight: 500;
        }
        input::placeholder, select option[disabled] { color: #94a3b8; } /* Slate-400 */
        input:focus, select:focus { background-color: white; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.25), 0 2px 4px rgba(0,0,0,0.04) inset; outline: none; }
        input[type="date"]::-webkit-calendar-picker-indicator { cursor: pointer; opacity: 0.8; filter: invert(0.5); transition: opacity 0.2s ease; }
        input[type="date"]::-webkit-calendar-picker-indicator:hover { opacity: 1; }
        select { 
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E"); /* Slate-500 */
            background-position: right 1rem center; background-repeat: no-repeat; background-size: 1.25em 1.25em; padding-right: 3rem;
        }
        /* Support RTL pour le select */
        html[dir="rtl"] select {
            background-position: left 1rem center;
            padding-left: 3rem;
            padding-right: 1.25rem;
        }
        .time-select { padding: 1rem 0.75rem; padding-right: 2.5rem; }
        html[dir="rtl"] .time-select {
            padding-left: 2.5rem;
            padding-right: 0.75rem;
        }

        /* Section Animation on Scroll */
        .section-animate { opacity: 0; } /* Start hidden for JS observer */
        .section-animate.visible { animation: fadeInUp 0.8s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
                
        /* Animation & initial state for Reservation Section - Using Tailwind classes */
        #reservation {
            /* Initial state set by Tailwind classes below */
            transition: max-height 0.7s ease-in-out, opacity 0.5s ease-in, padding 0.7s ease-in-out, margin 0.7s ease-in-out;
        }

        /* FAQ details style - Enhanced */
        details { transition: all 0.3s ease; border: 1px solid transparent; background-color: var(--color-bg-white); border-radius: 0.75rem; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 1rem; }
        details[open] { border-color: var(--color-primary-light); background-color: var(--color-bg-white); box-shadow: 0 6px 15px rgba(37, 99, 235, 0.15); }
        details > summary { list-style: none; padding: 1.5rem 2rem; font-weight: 600; color: var(--color-text-dark); cursor: pointer; transition: color 0.3s ease; display: flex; justify-content: space-between; align-items: center; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] > summary { color: var(--color-primary); }
        details[open] > summary i { transform: rotate(180deg); color: var(--color-primary); }
        details > summary i { transition: transform 0.4s cubic-bezier(0.165, 0.84, 0.44, 1), color 0.3s ease; color: var(--color-primary); font-size: 1.1em; }
        html[dir="rtl"] details[open] > summary i { transform: rotate(-180deg); }
        details div { padding: 0 2rem 1.5rem 2rem; color: var(--color-text-medium); line-height: 1.7; border-top: 1px solid var(--color-border-light); }

        /* Message Box Styling */
        #message-box { transition: opacity 0.3s ease, transform 0.3s ease; font-weight: 500; }

        /* General Button Styles - Pill Shape Option */
        .btn { padding: 0.8rem 2rem; border-radius: 9999px; /* rounded-full */ font-weight: 600; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); text-align: center; display: inline-flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; }
        .btn-primary { background-color: var(--color-primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--color-primary-dark); transform: translateY(-3px); box-shadow: 0 8px 15px rgba(37, 99, 235, 0.3); }
        .btn-accent { background-color: var(--color-accent); color: var(--color-bg-dark); } /* Dark text on yellow */
        .btn-accent:hover:not(:disabled) { background-color: var(--color-accent-dark); transform: translateY(-3px); box-shadow: 0 8px 15px rgba(245, 158, 11, 0.3); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; box-shadow: none; transform: none; }

        /* Section Titles - Bolder */
        .section-title { font-size: 2.75rem; /* ~text-4xl/5xl */ font-weight: 800; /* Extra bold */ color: var(--color-text-dark); text-align: center; margin-bottom: 1.5rem; line-height: 1.2; }
        .section-subtitle { font-size: 1.125rem; /* text-lg */ color: var(--color-text-medium); text-align: center; margin-bottom: 4rem; max-width: 650px; margin-left: auto; margin-right: auto; line-height: 1.8; }

        /* Enhanced Section Backgrounds */
        #reservation-container { background-color: var(--color-bg-light); border-bottom: 1px solid var(--color-border-light); } /* Container holds the bg color */
                
        #about-us {
            background-color: var(--color-accent); /* Yellow */
            color: var(--color-text-dark); /* Dark blue text */
        }
        #about-us h2 {
            color: var(--color-primary); /* Blue title */
            font-weight: 800;
        }

        #flotte { background-color: var(--color-bg-white); padding-top: 6rem; padding-bottom: 6rem; }
                
        #services { background: linear-gradient(145deg, var(--color-primary) 0%, var(--color-primary-dark) 100%); color: white; padding-top: 6rem; padding-bottom: 6rem; }
        #services .section-title, #services .section-subtitle { color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        #services .service-card { background-color: rgba(255, 255, 255, 0.08); border-radius: 1rem; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        #services .service-card h3 { color: white; }
        #services .service-card p { color: var(--color-text-light); opacity: 0.9; }
                
        #faq { background-color: var(--color-bg-light); /* Slate-100 */ padding-top: 6rem; padding-bottom: 6rem; }
                
        /* Style pour la section carte */
        #localisation { background-color: var(--color-bg-white); padding-top: 6rem; padding-bottom: 6rem; }

        #contact { background: var(--color-bg-darker); /* Slate-950 */ color: var(--color-text-light); padding-top: 6rem; padding-bottom: 6rem; }
        #contact h2 { color: white; }
        #contact p { color: var(--color-text-medium); } /* Lighter gray for dark bg */
        #contact a { color: var(--color-text-light); }
        #contact a:hover { color: var(--color-accent); }
        #contact i { color: var(--color-accent); transition: transform 0.3s ease; }
        #contact a:hover i { transform: scale(1.1); }

        /* Smooth scroll adjustment */
        html { scroll-padding-top: 100px; /* Adjust based on sticky header height */ }

        /* Hide scrollbar for Chrome, Safari and Opera */
        body::-webkit-scrollbar { display: none; }
        /* Hide scrollbar for IE, Edge and Firefox */
        body { -ms-overflow-style: none; /* IE and Edge */ scrollbar-width: none; /* Firefox */ }

        /* Styles pour le NOUVEAU sélecteur de langue */
        #lang-menu-dropdown {
            display: none; /* Caché par défaut, géré par JS */
        }
        #lang-menu-button.active + #lang-menu-dropdown {
            display: block; /* Afficher quand le bouton est actif */
        }
        html[dir="rtl"] #lang-menu-dropdown {
            right: auto;
            left: 0;
        }
        /* CORRECTION CONTRASTE: Rendre le texte des options de langue sombre sur fond blanc */
        #lang-menu-dropdown a { 
            color: var(--color-text-dark) !important; /* Force la couleur sombre */
        }
    </style>
</head>
<body class="bg-bg-light text-text-dark">

    <!-- Header -->
    <header id="main-header" class="fixed top-0 left-0 right-0 z-50 py-6 md:py-4 transition-all duration-300">
        <!-- CORRECTION STRUCTURE HEADER : Conteneur principal pour gérer le flex mobile/desktop -->
        <nav class="container mx-auto px-6 flex justify-between items-center relative">
                        
            <!-- Mobile: Logo (Gauche) et Bouton Menu (Droite) -->
            <div class="flex justify-between items-center w-full md:hidden">
                <!-- Mobile Logo (Gauche) -->
                <a href="#accueil" class="logo-container flex-shrink-0">
                   <img id="logo-mobile-white" src="https://i.imgur.com/uPC4OVz.png" alt="Palace Cars Logo Blanc">
                   <img id="logo-mobile-color" src="https://i.imgur.com/htqH0IE.png" alt="Palace Cars Logo Couleur">
                </a>
                
                <!-- Mobile Menu Button (Hamburger) -->
                <button id="mobile-menu-button" class="focus:outline-none p-2 -mr-2">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>

            <!-- Desktop: Liens (Gauche), Logo (Centre), Liens (Droite) -->
            <div class="hidden md:flex w-full justify-between items-center">
                
                <!-- Desktop Links (Left) -->
                <div class="flex items-center space-x-8 w-1/3">
                    <a href="#accueil" class="hover:text-accent font-medium" data-key="navHome">Accueil</a>
                    <a href="#flotte" class="hover:text-accent font-medium" data-key="navFleet">Notre Flotte</a>
                    <a href="#services" class="hover:text-accent font-medium" data-key="navServices">Services</a>
                </div>

                <!-- Desktop Logo (Center) -->
                <div class="flex w-1/3 justify-center">
                     <a href="#accueil" class="logo-container">
                         <img id="logo-desktop-white" src="https://i.imgur.com/uPC4OVz.png" alt="Palace Cars Logo Blanc">
                         <img id="logo-desktop-color" src="https://i.imgur.com/htqH0IE.png" alt="Palace Cars Logo Couleur">
                     </a>
                </div>

                <!-- Desktop Links & Button (Right) -->
                <div class="flex items-center justify-end space-x-6 w-1/3"> <!-- Espace réduit pour la langue -->
                    <a href="#faq" class="hover:text-accent font-medium" data-key="navFAQ">FAQ</a>
                    <a href="#contact" class="hover:text-accent font-medium" data-key="navContact">Contact</a>
                                        
                    <!-- NOUVEAU: Sélecteur de Langue Manuel (Desktop) -->
                    <div class="relative hidden md:block">
                        <button id="lang-menu-button" type="button" class="flex items-center font-medium transition-colors duration-300 px-2 py-1">
                            <i class="fas fa-globe mr-1.5"></i>
                            <span id="current-lang-text" class="uppercase text-sm font-semibold">FR</span>
                            <i class="fas fa-chevron-down ml-1.5 text-xs opacity-70"></i>
                        </button>
                        <div id="lang-menu-dropdown" class="hidden absolute right-0 mt-2 w-32 bg-white rounded-lg shadow-xl z-50 overflow-hidden border border-gray-100">
                            <a href="#" class="lang-option block px-4 py-2 text-sm hover:bg-primary-lighter hover:text-primary" data-lang="fr">Français</a>
                            <a href="#" class="lang-option block px-4 py-2 text-sm hover:bg-primary-lighter hover:text-primary" data-lang="en">English</a>
                            <a href="#" class="lang-option block px-4 py-2 text-sm hover:bg-primary-lighter hover:text-primary" data-lang="ar">العربية</a>
                        </div>
                    </div>

                    <a href="#reservation" id="nav-reserve-button" class="btn btn-accent text-sm px-6 py-2" data-key="navReserve">Réserver</a>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="md:hidden hidden bg-white shadow-lg mt-2 rounded-md">
            <!-- NOUVEAU: Sélecteur de Langue (Mobile) -->
            <div class="flex justify-center space-x-6 p-4 border-b border-gray-100">
                <a href="#" class="lang-option font-semibold text-text-dark" data-lang="fr">Français</a>
                <a href="#" class="lang-option font-medium text-text-medium" data-lang="en">English</a>
                <a href="#" class="lang-option font-medium text-text-medium" data-lang="ar">العربية</a>
            </div>

             <a href="#accueil" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100" data-key="navHome">Accueil</a>
             <a href="#flotte" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100" data-key="navFleet">Notre Flotte</a>
             <a href="#services" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100" data-key="navServices">Services</a>
             <a href="#faq" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100" data-key="navFAQ">FAQ</a>
             <a href="#contact" class="block px-6 py-3 hover:bg-primary-lighter hover:text-primary font-medium border-b border-gray-100" data-key="navContact">Contact</a>
             <a href="#reservation" id="mobile-reserve-button" class="block px-6 py-3 bg-accent text-slate-900 font-semibold text-center rounded-b-md hover:bg-accent-dark" data-key="navReserve">Réserver en Ligne</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="accueil" class="hero-bg text-white min-h-screen flex items-center justify-center relative">
        <div class="absolute inset-0 bg-gradient-to-t from-black via-blue-900/40 to-transparent opacity-80"></div>
        <div class="container mx-auto px-6 text-center relative z-10 pt-20">
            <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-4 leading-tight text-shadow-lg animate-fade-in-down" data-key="heroTitle">Palace Cars Agadir</h1>
            <p class="text-lg md:text-2xl text-gray-200 mb-10 max-w-3xl mx-auto animate-fade-in-up" style="animation-delay: 0.2s;" data-key="heroSubtitle">Location de voitures simple, rapide et aux meilleurs prix.</p>
            <!-- Bouton "Réserver en Ligne" -->
            <button id="hero-reserve-button" class="btn btn-accent text-lg px-10 py-4 animate-fade-in-up shadow-lg hover:shadow-xl hover:scale-105" style="animation-delay: 0.4s;">
                <span data-key="heroButton">Réserver en Ligne</span> <i class="fas fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
            </button>
        </div>
        <!-- Scroll Down Arrow (Optional) -->
        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 z-10 animate-bounce hidden md:block">
            <a href="#reservation" id="scroll-down-button">
                <i class="fas fa-chevron-down text-white text-3xl opacity-70 hover:opacity-100 transition-opacity"></i>
            </a>
        </div>
    </section>

    <!-- Reservation Form Section Container (Handles background and structure) -->
    <div id="reservation-container" class="bg-gradient-to-b from-slate-100 to-white">
        <!-- The actual Reservation Form Section - Initially Hidden & Animated -->
        <!-- Start hidden with Tailwind classes, add padding classes that will be applied when visible -->
        <section id="reservation" class="container mx-auto px-6 max-w-5xl max-h-0 opacity-0 overflow-hidden transition-all duration-700 ease-in-out p-0 m-0">
            <!-- Apply padding when visible via Tailwind classes -->
            <div class="bg-white p-8 md:p-16 rounded-2xl shadow-xl border border-gray-100 relative overflow-hidden mt-16 mb-16 md:mt-24 md:mb-24">
                <!-- Decorative elements -->
                <div class="absolute top-0 left-0 w-32 h-32 bg-blue-100 rounded-full opacity-30 -translate-x-1/3 -translate-y-1/3 filter blur-xl"></div>
                <div class="absolute bottom-0 right-0 w-48 h-48 bg-yellow-100 rounded-full opacity-30 translate-x-1/4 translate-y-1/4 filter blur-xl"></div>

                <div class="relative z-10">
                    <h2 class="section-title mb-10 text-primary" data-key="formTitle">Réservez Votre Véhicule</h2>

                    <!-- Message Box -->
                    <div id="message-box" class="hidden p-4 rounded-lg text-center mb-6"></div>

                    <!-- Formulaire -->
                    <form id="booking-form" class="space-y-6">
                        <!-- Web3Forms Hidden Inputs -->
                         <input type="hidden" name="subject" value="Nouvelle demande de réservation - Palace Cars">
                         <input type="hidden" name="from_name" value="Palace Cars Réservation">
                         <input type="hidden" name="access_key" value="9a2470af-9163-405c-abc9-3aafd98b14fd">
                         <input type="hidden" name="redirect" value="https://web3forms.com/success">

                        <!-- Champs Client -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="nomPrenom" class="block text-sm font-semibold text-gray-700 mb-2" data-key="formNameLabel">Nom et Prénom <span class="text-red-500">*</span></label>
                                <input type="text" id="nomPrenom" name="nomPrenom" required data-key="formNamePlaceholder" placeholder="Votre nom complet" class="block w-full">
                            </div>
                            <div>
                                <label for="telephone" class="block text-sm font-semibold text-gray-700 mb-2" data-key="formPhoneLabel">Téléphone <span class="text-red-500">*</span></label>
                                <input type="tel" id="telephone" name="telephone" required data-key="formPhonePlaceholder" placeholder="+212 6 XX XX XX XX" class="block w-full">
                            </div>
                        </div>
                         <div>
                            <label for="email" class="block text-sm font-semibold text-gray-700 mb-2" data-key="formEmailLabel">Adresse E-mail <span class="text-red-500">*</span></label>
                            <input type="email" id="email" name="email" required data-key="formEmailPlaceholder" placeholder="votre.email@exemple.com" class="block w-full">
                        </div>

                        <!-- Champs Lieu -->
                         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="lieuPriseEnCharge" class="block text-sm font-semibold text-gray-700 mb-2" data-key="formPickupLocationLabel">Lieu Prise en Charge <span class="text-red-500">*</span></label>
                                <input type="text" id="lieuPriseEnCharge" name="lieuPriseEnCharge" required data-key="formPickupLocationPlaceholder" placeholder="Aéroport, Hôtel..." class="block w-full">
                            </div>
                            <div>
                                <label for="lieuRetour" class="block text-sm font-semibold text-gray-700 mb-2" data-key="formReturnLocationLabel">Lieu Retour <span class="text-red-500">*</span></label>
                                <!-- Changé en Select comme demandé -->
                                <select id="lieuRetour" name="lieuRetour" required class="block w-full">
                                    <option value="" disabled selected data-key="formReturnLocationOption0">-- Choisir une option --</option>
                                    <option value="A Agadir" data-key="formReturnLocationOption1">A Agadir</option>
                                    <option value="En dehors d'Agadir" data-key="formReturnLocationOption2">En dehors d'Agadir</option>
                                </select>
                            </div>
                        </div>

                        <!-- Champs Date et Heure -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Date et Heure de Début -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2" data-key="formStartDateLabel">Début Location <span class="text-red-500">*</span></label>
                                <input type="date" id="datePriseEnCharge" name="datePriseEnCharge" required class="block w-full mb-2">
                                 <div class="grid grid-cols-2 gap-3">
                                     <select id="heurePriseEnChargeHeure" name="heurePriseEnChargeHeure" required class="block w-full time-select">
                                         <option value="" disabled selected data-key="formHour">Heure</option>
                                     </select>
                                     <select id="heurePriseEnChargeMinute" name="heurePriseEnChargeMinute" required class="block w-full time-select">
                                         <option value="" disabled selected data-key="formMinute">Minute</option>
                                     </select>
                                 </div>
                            </div>
                             <!-- Date et Heure de Fin -->
                             <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2" data-key="formEndDateLabel">Fin Location <span class="text-red-500">*</span></label>
                                <input type="date" id="dateRetour" name="dateRetour" required class="block w-full mb-2">
                                <div class="grid grid-cols-2 gap-3">
                                    <select id="heureRetourHeure" name="heureRetourHeure" required class="block w-full time-select">
                                        <option value="" disabled selected data-key="formHour">Heure</option>
                                    </select>
                                    <select id="heureRetourMinute" name="heureRetourMinute" required class="block w-full time-select">
                                        <option value="" disabled selected data-key="formMinute">Minute</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Bouton Vérifier Disponibilité -->
                        <div class="text-center pt-8">
                            <button type="button" id="check-availability-button" class="btn btn-primary w-full md:w-auto px-12 py-3.5 text-base disabled:opacity-50 shadow-lg hover:shadow-primary/50">
                                <span class="mr-2" data-key="formCheckButton">Vérifier la Disponibilité</span>
                                <i class="fas fa-search"></i>
                                <span id="availability-spinner" class="ml-2 inline-block border-2 border-white border-t-transparent rounded-full w-5 h-5 hidden animate-spin"></span>
                            </button>
                        </div>

                        <!-- Champ caché pour stocker la voiture sélectionnée -->
                         <input type="hidden" id="selectedCar" name="voiture">

                    </form> <!-- Fin du formulaire initial -->

                     <!-- Section pour afficher les voitures disponibles -->
                     <div id="available-cars-section" class="mt-16 hidden">
                         <hr class="mb-12 border-gray-200">
                         <h3 class="section-title text-3xl mb-12 text-primary" data-key="formAvailableCarsTitle">Voitures Disponibles</h3>
                         <div id="available-cars-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                             <!-- Les cartes de voitures seront injectées ici -->
                         </div>
                         <p id="no-cars-message" class="text-center text-text-medium mt-8 hidden text-lg" data-key="formNoCars">Désolé, aucune voiture n'est disponible pour les dates sélectionnées.</p>

                         <!-- Bouton Soumettre Final -->
                         <div class="text-center mt-16">
                             <button type="button" id="submit-booking-button" class="btn btn-accent w-full md:w-auto px-16 py-4 text-lg hidden disabled:opacity-50 shadow-xl hover:shadow-accent/50">
                                 <span data-key="formSubmitButton">Soumettre la Demande</span>
                                 <span id="submit-spinner" class="ml-2 inline-block border-2 border-slate-900 border-t-transparent rounded-full w-5 h-5 hidden animate-spin"></span>
                             </button>
                         </div>
                     </div>
                 </div>
            </div>
        </section> <!-- Fin de #reservation -->
    </div> <!-- Fin de #reservation-container -->

    <!-- Section "Qui sommes nous ?" (Corrigée pour être plus large) -->
    <section id="about-us" class="py-24 bg-accent section-animate" style="animation-delay: 0.1s;">
        <div class="container mx-auto px-6 max-w-6xl"> <!-- Classe max-w-6xl pour élargir -->
            <h2 class="section-title !text-primary mb-10 text-center" data-key="aboutTitle">Qui sommes nous ?</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                <!-- Paragraphes alignés à gauche -->
                <div class="text-left text-lg text-text-dark/80 space-y-6 leading-relaxed">
                    <p data-key="aboutP1">
                        Fondée en 1982, Palacecars s'est imposée comme une agence de location de voitures de référence au cœur d'Agadir. Forte de plus de quatre décennies d'expérience, cette entreprise a su bâtir une réputation solide, fondée sur la fiabilité de son service et une connaissance intime des attentes d'une clientèle locale et internationale. Elle représente une solution de mobilité privilégiée pour tous ceux qui souhaitent découvrir la capitale du Souss, ses plages ensoleillées et son arrière-pays en toute liberté et confiance.
                    </p>
                </div>
                 <div class="text-left text-lg text-text-dark/80 space-y-6 leading-relaxed">
                     <p data-key="aboutP2">
                         L'agence met un point d'honneur à proposer une flotte de véhicules diversifiée, soigneusement entretenue pour garantir sécurité et confort sur les routes marocaines. Palacecars s'efforce de répondre aux différents besoins de ses clients, en offrant des solutions adaptées à chaque type de séjour, qu'il s'agisse de déplacements professionnels ou de vacances. L'engagement de l'agence se traduit par un service client personnalisé, des procédures de location simplifiées et une tarification transparente, assurant ainsi une expérience de conduite agréable et sans tracas.
                     </p>
                 </div>
            </div>
        </div>
    </section>

    <!-- Featured Cars Section -->
    <section id="flotte" class="py-24 bg-white section-animate" style="animation-delay: 0.2s;">
        <div class="container mx-auto px-6">
            <h2 class="section-title" data-key="fleetTitle">Notre Flotte</h2>
            <p class="section-subtitle" data-key="fleetSubtitle">Des véhicules récents et bien entretenus pour tous vos besoins.</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Car Card 1 -->
                <div class="car-card">
                     <div class="relative group overflow-hidden rounded-t-lg">
                         <img src="https://placehold.co/300x200/e2e8f0/334155?text=Logan+D+24" alt="Dacia Logan Diesel 2024" class="w-full h-52 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                         <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                     </div>
                     <div class="p-6">
                         <h3 class="text-xl mb-2" data-key="car1Name">Dacia Logan Diesel 2024</h3>
                         <p class="mb-4 text-sm h-10 text-text-medium" data-key="car1Desc">Économique et fiable, idéale pour la ville.</p>
                         <div class="flex justify-between items-center mt-4">
                             <p class="text-xl price">250 Dhs <span class="text-sm font-normal text-text-medium" data-key="carPricePerDay">/ jour</span></p>
                             <a href="#reservation" class="btn btn-primary text-xs px-4 py-2 reserve-now-link" data-key="carReserve">Réserver</a>
                         </div>
                     </div>
                </div>
                <!-- Car Card 2 -->
                <div class="car-card">
                    <div class="relative group overflow-hidden rounded-t-lg">
                        <img src="https://placehold.co/300x200/e2e8f0/334155?text=Logan+D+25" alt="Dacia Logan Diesel 2025" class="w-full h-52 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                    </div>
                   <div class="p-6">
                        <h3 class="text-xl mb-2" data-key="car2Name">Dacia Logan Diesel 2025</h3>
                        <p class="mb-4 text-sm h-10 text-text-medium" data-key="car2Desc">Le dernier modèle, confort amélioré.</p>
                        <div class="flex justify-between items-center mt-4">
                            <p class="text-xl price">250 Dhs <span class="text-sm font-normal text-text-medium" data-key="carPricePerDay">/ jour</span></p>
                            <a href="#reservation" class="btn btn-primary text-xs px-4 py-2 reserve-now-link" data-key="carReserve">Réserver</a>
                        </div>
                   </div>
                </div>
                <!-- Car Card 3 -->
                <div class="car-card">
                    <div class="relative group overflow-hidden rounded-t-lg">
                        <img src="https://placehold.co/300x200/e2e8f0/334155?text=Sandero+E" alt="Dacia Sandero Essence" class="w-full h-52 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl mb-2" data-key="car3Name">Dacia Sandero Essence</h3>
                        <p class="mb-4 text-sm h-10 text-text-medium" data-key="car3Desc">Compacte et agile, parfaite pour la ville.</p>
                        <div class="flex justify-between items-center mt-4">
                            <p class="text-xl price">300 Dhs <span class="text-sm font-normal text-text-medium" data-key="carPricePerDay">/ jour</span></p>
                            <a href="#reservation" class="btn btn-primary text-xs px-4 py-2 reserve-now-link" data-key="carReserve">Réserver</a>
                        </div>
                    </div>
                </div>
                 <!-- Car Card 4 -->
                 <div class="car-card">
                     <div class="relative group overflow-hidden rounded-t-lg">
                         <img src="https://placehold.co/300x200/e2e8f0/334155?text=Sandero+D" alt="Dacia Sandero Diesel" class="w-full h-52 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                         <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                     </div>
                     <div class="p-6">
                         <h3 class="text-xl mb-2" data-key="car4Name">Dacia Sandero Diesel</h3>
                         <p class="mb-4 text-sm h-10 text-text-medium" data-key="car4Desc">Version diesel économique et polyvalente.</p>
                         <div class="flex justify-between items-center mt-4">
                            <p class="text-xl price">250 Dhs <span class="text-sm font-normal text-text-medium" data-key="carPricePerDay">/ jour</span></p>
                            <a href="#reservation" class="btn btn-primary text-xs px-4 py-2 reserve-now-link" data-key="carReserve">Réserver</a>
                         </div>
                     </div>
                 </div>
            </div>
        </div>
    </section>

    <!-- Services Section - Redesigned -->
    <section id="services" class="py-24 bg-gradient-to-br from-primary to-blue-800 text-white section-animate" style="animation-delay: 0.3s;">
        <div class="container mx-auto px-6 text-center">
            <h2 class="section-title mb-4" data-key="servicesTitle">Nos Engagements Qualité</h2>
            <p class="section-subtitle !text-blue-100 opacity-90" data-key="servicesSubtitle">Votre satisfaction est notre priorité.</p>
            <!-- Grille ajustée pour 5 éléments -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-8">
                <!-- Service Card 1 -->
                <div class="service-card bg-white/10 backdrop-blur-md p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-2 border border-white/10 hover:border-white/20">
                     <div class="text-accent text-6xl mb-6">
                         <i class="fas fa-plane-departure"></i>
                     </div>
                     <h3 class="text-2xl font-semibold mb-3" data-key="service1Title">Livraison Aéroport</h3>
                     <p class="opacity-90 leading-relaxed text-sm" data-key="service1Desc">Prise en charge et retour simplifiés à l'aéroport d'Agadir.</p>
                </div>
                <!-- Service Card 2 -->
                <div class="service-card bg-white/10 backdrop-blur-md p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-2 border border-white/10 hover:border-white/20">
                    <div class="text-accent text-6xl mb-6">
                         <i class="fas fa-headset"></i>
                    </div>
                    <h3 class="text-2xl font-semibold mb-3" data-key="service2Title">Assistance 24/7</h3>
                    <p class="opacity-90 leading-relaxed text-sm" data-key="service2Desc">Notre équipe est disponible à toute heure pour vous assister.</p>
                </div>
                <!-- Service Card 3 -->
                <div class="service-card bg-white/10 backdrop-blur-md p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-2 border border-white/10 hover:border-white/20">
                     <div class="text-accent text-6xl mb-6">
                         <i class="fas fa-infinity"></i>
                     </div>
                     <h3 class="text-2xl font-semibold mb-3" data-key="service3Title">Km Illimité</h3>
                     <p class="opacity-90 leading-relaxed text-sm" data-key="service3Desc">Explorez sans limites. Profitez pleinement de votre aventure.</p>
                </div>
                <!-- NOUVEAU: Service Card 4 (Porte-Surf) -->
                <div class="service-card bg-white/10 backdrop-blur-md p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-2 border border-white/10 hover:border-white/20">
                     <div class="text-accent text-6xl mb-6 flex justify-center space-x-3">
                         <i class="fas fa-person-surfing"></i> <!-- Icône Surf -->
                         <i class="fas fa-suitcase-rolling"></i> <!-- Icône Bagage -->
                     </div>
                     <h3 class="text-2xl font-semibold mb-3" data-key="service4Title">Porte-Surf & Bagages (Gratuit)</h3>
                     <p class="opacity-90 leading-relaxed text-sm" data-key="service4Desc">Accessoires fournis gratuitement sur demande.</p>
                </div>
                <!-- NOUVEAU: Service Card 5 (Siège Bébé) -->
                <div class="service-card bg-white/10 backdrop-blur-md p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-2 border border-white/10 hover:border-white/20 sm:col-span-2 lg:col-span-1"> <!-- Centre le 5ème sur mobile/tablette -->
                     <div class="text-accent text-6xl mb-6">
                         <i class="fas fa-baby-carriage"></i> <!-- Icône Siège Bébé -->
                     </div>
                     <h3 class="text-2xl font-semibold mb-3" data-key="service5Title">Siège Bébé (Gratuit)</h3>
                     <p class="opacity-90 leading-relaxed text-sm" data-key="service5Desc">Voyagez en toute sécurité avec vos enfants. Fourni gratuitement.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ Section - Redesigned -->
    <section id="faq" class="py-24 bg-bg-light section-animate" style="animation-delay: 0.4s;">
           <div class="container mx-auto px-6 max-w-4xl"> <!-- Wider container -->
             <h2 class="section-title" data-key="faqTitle">Questions Fréquentes</h2>
             <p class="section-subtitle" data-key="faqSubtitle">Trouvez rapidement les informations dont vous avez besoin.</p>

             <div class="space-y-4">
                 <details class="group">
                     <summary class="flex justify-between items-center cursor-pointer">
                         <span data-key="faq1Q">Quels documents sont nécessaires pour louer une voiture ?</span>
                         <i class="fas fa-chevron-down text-lg"></i>
                     </summary>
                     <div data-key="faq1A">Vous aurez besoin d'un permis de conduire valide depuis au moins un an, d'une pièce d'identité (passeport ou carte d'identité nationale en cours de validité), et d'une carte de crédit au nom du conducteur principal pour la caution.</div>
                 </details>

                 <details class="group">
                     <summary class="flex justify-between items-center cursor-pointer">
                         <span data-key="faq2Q">Quel est l'âge minimum requis pour louer ?</span>
                         <i class="fas fa-chevron-down text-lg"></i>
                     </summary>
                     <div data-key="faq2A">L'âge minimum standard est de 21 ans. Cependant, pour certaines catégories de véhicules (luxe, 4x4), un âge minimum plus élevé et/ou des années d'expérience de conduite supplémentaires peuvent être exigés.</div>
                 </details>

                 <details class="group">
                     <summary class="flex justify-between items-center cursor-pointer">
                         <span data-key="faq3Q">Quelles assurances sont incluses dans le prix ?</span>
                         <i class="fas fa-chevron-down text-lg"></i>
                     </summary>
                     <div data-key="faq3A">Nos tarifs incluent toujours l'assurance responsabilité civile obligatoire et une assurance de base couvrant les dommages au véhicule avec une franchise applicable en cas d'accident responsable. Des options d'assurance complémentaire (rachat de franchise, protection personnelle) sont disponibles.</div>
                 </details>

                 <details class="group">
                     <summary class="flex justify-between items-center cursor-pointer">
                         <span data-key="faq4Q">Puis-je conduire la voiture en dehors d'Agadir ?</span>
                         <i class="fas fa-chevron-down text-lg"></i>
                     </summary>
                     <div data-key="faq4A">Absolument ! Nos véhicules peuvent être conduits dans tout le Maroc. Nous vous demandons simplement de nous informer si vous prévoyez de très longs trajets ou de vous rendre dans des zones spécifiques. La sortie du territoire marocain n'est pas autorisée.</div>
                 </details>
             </div>
           </div>
    </section>

    <!-- SECTION: Localisation (Map) - MISE À JOUR avec le lien embed final -->
    <section id="localisation" class="py-24 bg-white section-animate" style="animation-delay: 0.5s;">
        <div class="container mx-auto px-6 max-w-6xl"> <!-- Classe max-w-6xl pour élargir -->
            <h2 class="section-title" data-key="mapTitle">Notre Localisation</h2>
            <p class="section-subtitle" data-key="mapSubtitle">Retrouvez-nous facilement au cœur d'Agadir. <br>125 Rue de Fes, Agadir 80000</p>
            <div class="w-full overflow-hidden rounded-2xl shadow-xl border border-gray-200" style="height: 450px;">
                <!-- Remplacement par le lien Google Maps embed fourni par l'utilisateur -->
                <iframe
                    width="100%"
                    height="100%"
                    style="border:0;"
                    allowfullscreen=""
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1012.5211566129202!2d-9.590451344829344!3d30.413920317807797!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xdb3b70022d1ea55%3A0x337e36ecaa7433b3!2sPalacecars%20Agadir!5e1!3m2!1sfr!2sma!4v1762376275829!5m2!1sfr!2sma">
                </iframe>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-24 bg-bg-darker text-white section-animate" style="animation-delay: 0.5s;">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-4xl font-bold mb-6 text-primary" data-key="contactTitle">Contactez-Nous</h2>
            <p class="mb-12 max-w-xl mx-auto text-gray-400 text-lg leading-relaxed" data-key="contactSubtitle">Une question ? Besoin d'un devis personnalisé ? Notre équipe est prête à vous aider.</p>
            
            <div class="flex flex-col md:flex-row justify-center items-center space-y-8 md:space-y-0 md:space-x-12">
                <a href="tel:+212659198122" class="text-xl font-medium hover:text-accent transition duration-300 flex items-center group">
                    <i class="fas fa-phone mr-3 text-accent text-3xl group-hover:scale-110 transition-transform duration-300"></i>
                    <span>+212 659 198 122</span>
                </a>
                <a href="mailto:contact@palacecars.ma" class="text-xl font-medium hover:text-accent transition duration-300 flex items-center group">
                    <i class="fas fa-envelope mr-3 text-accent text-3xl group-hover:scale-110 transition-transform duration-300"></i>
                    <span>contact@palacecars.ma</span>
                </a>
                 <a href="https://wa.me/212659198122" target="_blank" class="text-xl font-medium hover:text-accent transition duration-300 flex items-center group">
                    <i class="fab fa-whatsapp mr-3 text-accent text-3xl group-hover:scale-110 transition-transform duration-300"></i>
                    <span data-key="contactWhatsApp">WhatsApp Direct</span>
                 </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-bg-dark text-gray-400 py-12 border-t border-gray-800">
        <div class="container mx-auto px-6 text-center">
             <div class="mb-6">
                 <a href="#accueil" class="px-3 hover:text-accent text-sm transition duration-300" data-key="footerHome">Accueil</a> |
                 <a href="#reservation" class="px-3 hover:text-accent text-sm transition duration-300 reserve-now-link" data-key="footerReserve">Réserver</a> |
                 <a href="#flotte" class="px-3 hover:text-accent text-sm transition duration-300" data-key="footerFleet">Flotte</a> |
                 <a href="#services" class="px-3 hover:text-accent text-sm transition duration-300" data-key="footerServices">Services</a> |
                 <a href="#faq" class="px-3 hover:text-accent text-sm transition duration-300" data-key="footerFAQ">FAQ</a> |
                 <a href="#contact" class="px-3 hover:text-accent text-sm transition duration-300" data-key="footerContact">Contact</a>
             </div>
             <img src="https://i.imgur.com/ZtFVbmL.png" alt="Palace Cars Logo Footer" class="h-14 w-14 mx-auto mb-5 rounded-full shadow-lg border-2 border-gray-700">
             <p class="text-sm" data-key="footerRights">&copy; <span id="current-year"></span> PalaceCars - Tous droits réservés. Location de voiture Agadir.</p>
             <p class="text-xs mt-3 text-gray-500" data-key="footerCredits">Design & Développement</p>
        </div>
    </footer>

    <!-- Script Firebase & Logique -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, where, orderBy, doc, getDoc, getDocs, Timestamp, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyCsPHf_v8-gEiWGQzkwses-jOiDXs9tvWo",
            authDomain: "palace-cars.firebaseapp.com",
            projectId: "palace-cars",
            storageBucket: "palace-cars.firebasestorage.app",
            messagingSenderId: "469852272715",
            appId: "1:469852272715:web:6e87dc7083cdc04e03b5ce",
            measurementId: "G-KCEF4WBW0G"
        };

        // --- NOUVEAU: Base de données de traduction ---
        const translations = {
            'fr': {
                siteTitle: "Palace Cars - Location de Voiture Agadir",
                navHome: "Accueil",
                navFleet: "Notre Flotte",
                navServices: "Services",
                navFAQ: "FAQ",
                navContact: "Contact",
                navReserve: "Réserver",
                heroTitle: "Palace Cars Agadir",
                heroSubtitle: "Location de voitures simple, rapide et aux meilleurs prix.",
                heroButton: "Réserver en Ligne",
                formTitle: "Réservez Votre Véhicule",
                formNameLabel: "Nom et Prénom",
                formNamePlaceholder: "Votre nom complet",
                formPhoneLabel: "Téléphone",
                formPhonePlaceholder: "+212 6 XX XX XX XX",
                formEmailLabel: "Adresse E-mail",
                formEmailPlaceholder: "votre.email@exemple.com",
                formPickupLocationLabel: "Lieu Prise en Charge",
                formPickupLocationPlaceholder: "Aéroport, Hôtel...",
                formReturnLocationLabel: "Lieu Retour",
                formReturnLocationOption0: "-- Choisir une option --",
                formReturnLocationOption1: "A Agadir",
                formReturnLocationOption2: "En dehors d'Agadir",
                formStartDateLabel: "Début Location",
                formEndDateLabel: "Fin Location",
                formHour: "Heure",
                formMinute: "Minute",
                formCheckButton: "Vérifier la Disponibilité",
                formAvailableCarsTitle: "Voitures Disponibles",
                formNoCars: "Désolé, aucune voiture n'est disponible pour les dates sélectionnées.",
                formSubmitButton: "Soumettre la Demande",
                formSelectCar: "Sélectionner",
                formSelectedCar: "Sélectionnée",
                formUnavailable: "Indisponible",
                aboutTitle: "Qui sommes nous ?",
                aboutP1: "Fondée en 1982, Palacecars s'est imposée comme une agence de location de voitures de référence au cœur d'Agadir. Forte de plus de quatre décennies d'expérience, cette entreprise a su bâtir une réputation solide, fondée sur la fiabilité de son service et une connaissance intime des attentes d'une clientèle locale et internationale. Elle représente une solution de mobilité privilégiée pour tous ceux qui souhaitent découvrir la capitale du Souss, ses plages ensoleillées et son arrière-pays en toute liberté et confiance.",
                aboutP2: "L'agence met un point d'honneur à proposer une flotte de véhicules diversifiée, soigneusement entretenue pour garantir sécurité et confort sur les routes marocaines. Palacecars s'efforce de répondre aux différents besoins de ses clients, en offrant des solutions adaptées à chaque type de séjour, qu'il s'agisse de déplacements professionnels ou de vacances. L'engagement de l'agence se traduit par un service client personnalisé, des procédures de location simplifiées et une tarification transparente, assurant ainsi une expérience de conduite agréable et sans tracas.",
                fleetTitle: "Notre Flotte",
                fleetSubtitle: "Des véhicules récents et bien entretenus pour tous vos besoins.",
                car1Name: "Dacia Logan Diesel 2024",
                car1Desc: "Économique et fiable, idéale pour la ville.",
                carPricePerDay: "/ jour",
                carReserve: "Réserver",
                car2Name: "Dacia Logan Diesel 2025",
                car2Desc: "Le dernier modèle, confort amélioré.",
                car3Name: "Dacia Sandero Essence",
                car3Desc: "Compacte et agile, parfaite pour la ville.",
                car4Name: "Dacia Sandero Diesel",
                car4Desc: "Version diesel économique et polyvalente.",
                servicesTitle: "Nos Engagements Qualité",
                servicesSubtitle: "Votre satisfaction est notre priorité.",
                service1Title: "Livraison Aéroport",
                service1Desc: "Prise en charge et retour simplifiés à l'aéroport d'Agadir.",
                service2Title: "Assistance 24/7",
                service2Desc: "Notre équipe est disponible à toute heure pour vous assister.",
                service3Title: "Km Illimité",
                service3Desc: "Explorez sans limites. Profitez pleinement de votre aventure.",
                service4Title: "Porte-Surf & Bagages (Gratuit)",
                service4Desc: "Accessoires fournis gratuitement sur demande.",
                service5Title: "Siège Bébé (Gratuit)",
                service5Desc: "Voyagez en toute sécurité avec vos enfants. Fourni gratuitement.",
                faqTitle: "Questions Fréquentes",
                faqSubtitle: "Trouvez rapidement les informations dont vous avez besoin.",
                faq1Q: "Quels documents sont nécessaires pour louer une voiture ?",
                faq1A: "Vous aurez besoin d'un permis de conduire valide depuis au moins un an, d'une pièce d'identité (passeport ou carte d'identité nationale en cours de validité), et d'une carte de crédit au nom du conducteur principal pour la caution.",
                faq2Q: "Quel est l'âge minimum requis pour louer ?",
                faq2A: "L'âge minimum standard est de 21 ans. Cependant, pour certaines catégories de véhicules (luxe, 4x4), un âge minimum plus élevé et/ou des années d'expérience de conduite supplémentaires peuvent être exigés.",
                faq3Q: "Quelles assurances sont incluses dans le prix ?",
                faq3A: "Nos tarifs incluent toujours l'assurance responsabilité civile obligatoire et une assurance de base couvrant les dommages au véhicule avec une franchise applicable en cas d'accident responsable. Des options d'assurance complémentaire (rachat de franchise, protection personnelle) sont disponibles.",
                faq4Q: "Puis-je conduire la voiture en dehors d'Agadir ?",
                faq4A: "Absolument ! Nos véhicules peuvent être conduits dans tout le Maroc. Nous vous demandons simplement de nous informer si vous prévoyez de très longs trajets ou de vous rendre dans des zones spécifiques. La sortie du territoire marocain n'est pas autorisée.",
                mapTitle: "Notre Localisation",
                mapSubtitle: "Retrouvez-nous facilement au cœur d'Agadir. <br>125 Rue de Fes, Agadir 80000",
                contactTitle: "Contactez-Nous",
                contactSubtitle: "Une question ? Besoin d'un devis personnalisé ? Notre équipe est prête à vous aider.",
                contactWhatsApp: "WhatsApp Direct",
                footerHome: "Accueil",
                footerReserve: "Réserver",
                footerFleet: "Flotte",
                footerServices: "Services",
                footerFAQ: "FAQ",
                footerContact: "Contact",
                footerRights: "© [YEAR] PalaceCars - Tous droits réservés. Location de voiture Agadir.",
                footerCredits: "Design & Développement",
                // Messages d'erreur
                formErrorDB: "La base de données n'est pas prête. Réessayez.",
                formErrorDatesRequired: "Veuillez sélectionner les dates et heures complètes.",
                formErrorDatePast: "La date de prise en charge ne peut pas être dans le passé.",
                formErrorDateEnd: "La date/heure de fin doit être après la date/heure de début.",
                formErrorCheck: "Une erreur s'est produite lors de la vérification. Veuillez réessayer.",
                formErrorSelectCar: "Veuillez d'abord sélectionner une voiture.",
                formErrorInvalidDates: "Dates invalides. Revérifiez la disponibilité.",
                formErrorFieldRequired: "Le champ \"[FIELD]\" est requis.",
                formErrorCarUnavailable: "Désolé, la voiture \"[CAR]\" vient d'être indisponible. Veuillez choisir une autre voiture.",
                formErrorBookingDB: "Erreur technique lors de l'enregistrement de la réservation. Veuillez réessayer.",
                formSuccess: "Demande Envoyée avec Succès ! On va vous contacter le plus proche possible pour la confirmation.",
                formWarningEmail: "Demande enregistrée, mais l'e-mail de notification a échoué. Nous vous contacterons quand même."
            },
            'en': {
                siteTitle: "Palace Cars - Car Rental Agadir",
                navHome: "Home",
                navFleet: "Our Fleet",
                navServices: "Services",
                navFAQ: "FAQ",
                navContact: "Contact",
                navReserve: "Book Now",
                heroTitle: "Palace Cars Agadir",
                heroSubtitle: "Simple, fast, and best-priced car rentals.",
                heroButton: "Book Online",
                formTitle: "Book Your Vehicle",
                formNameLabel: "Full Name",
                formNamePlaceholder: "Your full name",
                formPhoneLabel: "Phone",
                formPhonePlaceholder: "+212 6 XX XX XX XX",
                formEmailLabel: "Email Address",
                formEmailPlaceholder: "your.email@example.com",
                formPickupLocationLabel: "Pickup Location",
                formPickupLocationPlaceholder: "Airport, Hotel...",
                formReturnLocationLabel: "Return Location",
                formReturnLocationOption0: "-- Choose an option --",
                formReturnLocationOption1: "In Agadir",
                formReturnLocationOption2: "Outside Agadir",
                formStartDateLabel: "Rental Start",
                formEndDateLabel: "Rental End",
                formHour: "Hour",
                formMinute: "Minute",
                formCheckButton: "Check Availability",
                formAvailableCarsTitle: "Available Cars",
                formNoCars: "Sorry, no cars are available for the selected dates.",
                formSubmitButton: "Submit Request",
                formSelectCar: "Select",
                formSelectedCar: "Selected",
                formUnavailable: "Unavailable",
                aboutTitle: "About Us",
                aboutP1: "Founded in 1982, Palacecars has established itself as a leading car rental agency in the heart of Agadir. With over four decades of experience, this company has built a solid reputation based on reliable service and an intimate understanding of local and international customer expectations. It represents a preferred mobility solution for all who wish to discover the Souss capital, its sunny beaches, and its backcountry with complete freedom and confidence.",
                aboutP2: "The agency makes it a point of honor to offer a diverse fleet of vehicles, carefully maintained to ensure safety and comfort on Moroccan roads. Palacecars strives to meet the various needs of its clients by offering solutions adapted to each type of stay, whether for business trips or holidays. The agency's commitment is reflected in personalized customer service, simplified rental procedures, and transparent pricing, thus ensuring a pleasant and hassle-free driving experience.",
                fleetTitle: "Our Fleet",
                fleetSubtitle: "Recent, well-maintained vehicles for all your needs.",
                car1Name: "Dacia Logan Diesel 2024",
                car1Desc: "Economical and reliable, ideal for the city.",
                carPricePerDay: "/ day",
                carReserve: "Book",
                car2Name: "Dacia Logan Diesel 2025",
                car2Desc: "The latest model, improved comfort.",
                car3Name: "Dacia Sandero Gasoline",
                car3Desc: "Compact and agile, perfect for the city.",
                car4Name: "Dacia Sandero Diesel",
                car4Desc: "Economical and versatile diesel version.",
                servicesTitle: "Our Quality Commitments",
                servicesSubtitle: "Your satisfaction is our priority.",
                service1Title: "Airport Delivery",
                service1Desc: "Simplified pickup and return at Agadir airport.",
                service2Title: "24/7 Assistance",
                service2Desc: "Our team is available at all hours to assist you.",
                service3Title: "Unlimited Km",
                service3Desc: "Explore without limits. Fully enjoy your adventure.",
                service4Title: "Surf & Luggage Rack (Free)",
                service4Desc: "Accessories provided free of charge upon request.",
                service5Title: "Baby Seat (Free)",
                service5Desc: "Travel safely with your children. Provided free of charge.",
                faqTitle: "Frequently Asked Questions",
                faqSubtitle: "Quickly find the information you need.",
                faq1Q: "What documents are needed to rent a car?",
                faq1A: "You will need a valid driver's license held for at least one year, an ID (valid passport or national ID card), and a credit card in the main driver's name for the deposit.",
                faq2Q: "What is the minimum age required to rent?",
                faq2A: "The standard minimum age is 21. However, for certain vehicle categories (luxury, 4x4), a higher minimum age and/or additional years of driving experience may be required.",
                faq3Q: "What insurance is included in the price?",
                faq3A: "Our rates always include mandatory third-party liability insurance and basic insurance covering damage to the vehicle with an applicable excess (deductible) in case of an at-fault accident. Additional insurance options (excess waiver, personal protection) are available.",
                faq4Q: "Can I drive the car outside of Agadir?",
                faq4A: "Absolutely! Our vehicles can be driven throughout Morocco. We just ask that you inform us if you plan very long trips or travel to specific areas. Leaving Moroccan territory is not allowed.",
                mapTitle: "Our Location",
                mapSubtitle: "Find us easily in the heart of Agadir. <br>125 Rue de Fes, Agadir 80000",
                contactTitle: "Contact Us",
                contactSubtitle: "Have a question? Need a personalized quote? Our team is ready to help.",
                contactWhatsApp: "Direct WhatsApp",
                footerHome: "Home",
                footerReserve: "Book",
                footerFleet: "Fleet",
                footerServices: "Services",
                footerFAQ: "FAQ",
                footerContact: "Contact",
                footerRights: "© [YEAR] PalaceCars - All rights reserved. Car Rental Agadir.",
                footerCredits: "Design & Development",
                // Error Messages
                formErrorDB: "Database is not ready. Please try again.",
                formErrorDatesRequired: "Please select complete dates and times.",
                formErrorDatePast: "The pickup date cannot be in the past.",
                formErrorDateEnd: "The end date/time must be after the start date/time.",
                formErrorCheck: "An error occurred during verification. Please try again.",
                formErrorSelectCar: "Please select a car first.",
                formErrorInvalidDates: "Invalid dates. Please re-check availability.",
                formErrorFieldRequired: "The field \"[FIELD]\" is required.",
                formErrorCarUnavailable: "Sorry, the car \"[CAR]\" just became unavailable. Please choose another car.",
                formErrorBookingDB: "Technical error while saving the booking. Please try again.",
                formSuccess: "Request Sent Successfully! We will contact you as soon as possible for confirmation.",
                formWarningEmail: "Request saved, but the email notification failed. We will still contact you."
            },
            'ar': {
                siteTitle: "بالاس كارز - تأجير سيارات أكادير",
                navHome: "الرئيسية",
                navFleet: "أسطولنا",
                navServices: "خدماتنا",
                navFAQ: "الأسئلة الشائعة",
                navContact: "اتصل بنا",
                navReserve: "احجز الآن",
                heroTitle: "بالاس كارز أكادير",
                heroSubtitle: "تأجير سيارات بسيط، سريع، وبأفضل الأسعار.",
                heroButton: "احجز عبر الإنترنت",
                formTitle: "احجز سيارتك",
                formNameLabel: "الاسم الكامل",
                formNamePlaceholder: "اسمك الكامل",
                formPhoneLabel: "الهاتف",
                formPhonePlaceholder: "+212 6 XX XX XX XX",
                formEmailLabel: "البريد الإلكتروني",
                formEmailPlaceholder: "email@example.com",
                formPickupLocationLabel: "مكان الاستلام",
                formPickupLocationPlaceholder: "المطار، الفندق...",
                formReturnLocationLabel: "مكان الإرجاع",
                formReturnLocationOption0: "-- اختر خياراً --",
                formReturnLocationOption1: "في أكادير",
                formReturnLocationOption2: "خارج أكادير",
                formStartDateLabel: "بداية الإيجار",
                formEndDateLabel: "نهاية الإيجار",
                formHour: "ساعة",
                formMinute: "دقيقة",
                formCheckButton: "تحقق من التوفر",
                formAvailableCarsTitle: "السيارات المتاحة",
                formNoCars: "عذراً، لا توجد سيارات متاحة للتواريخ المحددة.",
                formSubmitButton: "إرسال الطلب",
                formSelectCar: "اختر",
                formSelectedCar: "تم الاختيار",
                formUnavailable: "غير متاح",
                aboutTitle: "من نحن ؟",
                aboutP1: "تأسست بالاس كارز عام 1982، وفرضت نفسها كوكالة رائدة لتأجير السيارات في قلب أكادير. بخبرة تمتد لأكثر من أربعة عقود، بنت الشركة سمعة قوية قائمة على موثوقية خدمتها وفهمها العميق لتوقعات العملاء المحليين والدوليين. إنها تمثل حلاً مفضلاً للتنقل لكل من يرغب في اكتشاف عاصمة سوس وشواطئها المشمسة وضواحيها بكل حرية وثقة.",
                aboutP2: "تولي الوكالة اهتماماً كبيراً لتقديم أسطول متنوع من المركبات، تتم صيانته بعناية لضمان السلامة والراحة على الطرق المغربية. تسعى بالاس كارز لتلبية احتياجات عملائها المختلفة، بتقديم حلول مصممة خصيصاً لكل نوع من الإقامات، سواء كانت لرحلات العمل أو العطلات. يترجم التزام الوكالة في خدمة عملاء شخصية، إجراءات تأجير مبسطة، وأسعار شفافة، مما يضمن تجربة قيادة ممتعة وخالية من المتاعب.",
                fleetTitle: "أسطولنا",
                fleetSubtitle: "مركبات حديثة ومصانة جيداً لجميع احتياجاتك.",
                car1Name: "داسيا لوغان ديزل 2024",
                car1Desc: "اقتصادية وموثوقة، مثالية للمدينة.",
                carPricePerDay: "/ اليوم",
                carReserve: "احجز",
                car2Name: "داسيا لوغان ديزل 2025",
                car2Desc: "أحدث طراز، راحة محسنة.",
                car3Name: "داسيا سانديرو بنزين",
                car3Desc: "مدمجة ورشيقة، مثالية للمدينة.",
                car4Name: "داسIA سانديرو ديزل",
                car4Desc: "نسخة ديزل اقتصادية ومتعددة الاستخدامات.",
                servicesTitle: "التزاماتنا بالجودة",
                servicesSubtitle: "رضاكم هو أولويتنا.",
                service1Title: "التسليم في المطار",
                service1Desc: "استلام وإرجاع مبسط في مطار أكادير.",
                service2Title: "مساعدة 24/7",
                service2Desc: "فريقنا متاح في أي وقت لمساعدتك.",
                service3Title: "كم غير محدود",
                service3Desc: "استكشف بلا حدود. استمتع بمغامرتك بالكامل.",
                service4Title: "حامل ركوب الأمواج والأمتعة (مجاني)",
                service4Desc: "ملحقات تُقدم مجاناً عند الطلب.",
                service5Title: "مقعد أطفال (مجاني)",
                service5Desc: "سافر بأمان مع أطفالك. يُقدم مجاناً.",
                faqTitle: "الأسئلة الشائعة",
                faqSubtitle: "اعثر بسرعة على المعلومات التي تحتاجها.",
                faq1Q: "ما هي المستندات المطلوبة لاستئجار سيارة؟",
                faq1A: "ستحتاج إلى رخصة قيادة سارية المفعول لمدة عام على الأقل، وثيقة هوية (جواز سفر ساري المفعول أو بطاقة هوية وطنية)، وبطاقة ائتمان باسم السائق الرئيسي للضمان.",
                faq2Q: "ما هو الحد الأدنى للعمر المطلوب للاستئجار؟",
                faq2A: "الحد الأدنى للعمر هو 21 عاماً. ومع ذلك، بالنسبة لفئات معينة من المركبات (الفاخرة، 4x4)، قد يُطلب عمر أدنى أعلى و/أو سنوات إضافية من الخبرة في القيادة.",
                faq3Q: "ما هي التأمينات المدرجة في السعر؟",
                faq3A: "تشمل أسعارنا دائماً تأمين المسؤولية المدنية الإلزامي وتأميناً أساسياً يغطي الأضرار التي تلحق بالمركبة مع خصم (تحمل) مطبق في حالة وقوع حادث بخطأ منك. تتوفر خيارات تأمين إضافية (إلغاء الخصم، حماية شخصية).",
                faq4Q: "هل يمكنني قيادة السيارة خارج أكادير؟",
                faq4A: "بالتأكيد! يمكن قيادة مركباتنا في جميع أنحاء المغرب. نطلب منك فقط إبلاغنا إذا كنت تخطط لرحلات طويلة جداً أو السفر إلى مناطق معينة. الخروج من الأراضي المغربية غير مسموح به.",
                mapTitle: "موقعنا",
                mapSubtitle: "تجدنا بسهولة في قلب أكادير. <br>125 شارع فاس، أكادير 80000",
                contactTitle: "اتصل بنا",
                contactSubtitle: "لديك سؤال؟ هل تحتاج إلى عرض أسعار مخصص؟ فريقنا جاهز للمساعدة.",
                contactWhatsApp: "واتساب مباشر",
                footerHome: "الرئيسية",
                footerReserve: "احجز",
                footerFleet: "الأسطول",
                footerServices: "خدماتنا",
                footerFAQ: "الأسئلة الشائعة",
                footerContact: "اتصل بنا",
                footerRights: "© [YEAR] بالاس كارز - جميع الحقوق محفوظة. تأجير سيارات أكادير.",
                footerCredits: "تصميم وتطوير",
                // Messages d'erreur
                formErrorDB: "قاعدة البيانات ليست جاهزة. يرجى المحاولة مرة أخرى.",
                formErrorDatesRequired: "يرجى تحديد التواريخ والأوقات الكاملة.",
                formErrorDatePast: "لا يمكن أن يكون تاريخ الاستلام في الماضي.",
                formErrorDateEnd: "يجب أن يكون تاريخ/وقت الانتهاء بعد تاريخ/وقت البدء.",
                formErrorCheck: "حدث خطأ أثناء التحقق. يرجى المحاولة مرة أخرى.",
                formErrorSelectCar: "يرجى اختيار سيارة أولاً.",
                formErrorInvalidDates: "تواريخ غير صالحة. يرجى إعادة التحقق من التوفر.",
                formErrorFieldRequired: "الحقل \"[FIELD]\" مطلوب.",
                formErrorCarUnavailable: "عذراً، السيارة \"[CAR]\" أصبحت غير متاحة للتو. يرجى اختيار سيارة أخرى.",
                formErrorBookingDB: "خطأ فني أثناء حفظ الحجز. يرجى المحاولة مرة أخرى.",
                formSuccess: "تم إرسال الطلب بنجاح! سنتصل بك في أقرب وقت ممكن للتأكيد.",
                formWarningEmail: "تم حفظ الطلب، ولكن فشل إرسال إشعار البريد الإلكتروني. سنتصل بك على أي حال."
            }
        };

        // --- Initialize Firebase ---
        let db;
        let bookingsCollectionRef;
        let unavailabilityPeriodsCollectionRef;
        let carManualStatusCollectionRef;
        let dbReady = false;

        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            bookingsCollectionRef = collection(db, "palace_cars_bookings");
            unavailabilityPeriodsCollectionRef = collection(db, "car_unavailability_periods");
            carManualStatusCollectionRef = collection(db, "car_manual_status");
            dbReady = true;
            console.log("Firebase initialisé avec succès.");
        } catch (error) {
            console.error("Erreur critique d'initialisation Firebase:", error);
             const initialMessageBox = document.getElementById('message-box');
             const reservationSectionEl = document.getElementById('reservation');
             if(initialMessageBox && reservationSectionEl) {
                 // Make section visible to show the error
                 reservationSectionEl.classList.remove('max-h-0', 'opacity-0', 'p-0', 'm-0', 'overflow-hidden');
                 reservationSectionEl.classList.add('py-20', 'md:py-32', 'opacity-100', 'max-h-[3000px]', 'my-16', 'md:my-24');
                 
                 reservationSectionEl.scrollIntoView({ behavior: 'smooth', block: 'start' });

                 initialMessageBox.textContent = "Erreur critique: Impossible de connecter à la base de données.";
                 initialMessageBox.className = 'p-4 rounded-lg text-center mb-6 font-medium bg-red-100 text-red-800 border border-red-300';
                 initialMessageBox.classList.remove('hidden');
             }
        }

         // --- Liste des Voitures et Prix ---
         const carFleet = {
             "Dacia Logan Diesel 2024": { price: 250, image: "https://placehold.co/300x200/e2e8f0/334155?text=Logan+D+24" },
             "Dacia Logan Diesel 2025": { price: 250, image: "https://placehold.co/300x200/e2e8f0/334155?text=Logan+D+25" },
             "Dacia Sandero Essence": { price: 300, image: "https://placehold.co/300x200/e2e8f0/334155?text=Sandero+E" },
             "Dacia Sandero Diesel": { price: 250, image: "https://placehold.co/300x200/e2e8f0/334155?text=Sandero+D" },
         };
         const carNames = Object.keys(carFleet);


        // --- DÉBUT DES FONCTIONS RESTAURÉES ---

        // Variables globales pour le formulaire (définies dans DOMContentLoaded)
        let selectedCarName = null;
        let currentPickupDateTime = null;
        let currentReturnDateTime = null;

        // Éléments DOM (définis dans DOMContentLoaded)
        let mainHeader, heroReserveButton, scrollDownButton, reservationSection, form, messageBox, checkAvailabilityButton, availabilitySpinner, availableCarsSection, availableCarsListDiv, noCarsMessage, submitBookingButton, submitSpinner, selectedCarInput, mobileMenuButton, mobileMenu, navReserveButton, mobileReserveButton, reserveNowLinks, logoWhiteMobile, logoColorMobile, logoWhiteDesktop, logoColorDesktop, nomPrenomInput, telephoneInput, emailInput, lieuPriseEnChargeInput, lieuRetourInput, datePriseEnChargeInput, heurePriseEnChargeHeureSelect, heurePriseEnChargeMinuteSelect, dateRetourInput, heureRetourHeureSelect, heureRetourMinuteSelect, currentYearSpan;
        // NOUVEAU: Éléments de langue
        let langMenuButton, langMenuDropdown, langOptions, mobileLangOptions, currentLangText;


        // --- NOUVEAU: Fonctions de traduction ---
        function updateContent(lang) {
            if (!translations[lang]) {
                console.warn(`Langue non trouvée: ${lang}`);
                return;
            }
                        
            const translationData = translations[lang];
                        
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.dataset.key;
                let text = translationData[key];

                if (text === undefined) {
                    console.warn(`Clé de traduction manquante: ${key} pour la langue: ${lang}`);
                    return;
                }

                // Remplacer [YEAR] dans le footer
                if (key === 'footerRights') {
                    text = text.replace('[YEAR]', new Date().getFullYear());
                }
                
                // Remplacer les placeholders dans les messages d'erreur
                if (element.id === 'message-box' && element.dataset.messageParams) {
                    const params = JSON.parse(element.dataset.messageParams);
                    if (params.field) text = text.replace('[FIELD]', params.field);
                    if (params.car) text = text.replace('[CAR]', params.car);
                }

                const tagName = element.tagName.toLowerCase();
                if (tagName === 'input' || tagName === 'textarea') {
                    if (element.type === 'placeholder' || element.placeholder) {
                        element.placeholder = text;
                    } else if (element.type === 'submit' || element.type === 'button') {
                        element.value = text;
                    }
                } else if (tagName === 'option' && element.disabled) {
                    element.textContent = text;
                } else {
                    // Utiliser innerHTML pour les clés qui contiennent <br>
                    if (key === 'mapSubtitle') {
                        element.innerHTML = text;
                    } else {
                        element.textContent = text;
                    }
                }
            });
        }

        function changeLanguage(lang) {
            if (!translations[lang]) lang = 'fr'; // Revenir au français par défaut
                        
            // 1. Sauvegarder la langue
            localStorage.setItem('language', lang);

            // 2. Mettre à jour l'attribut lang et dir
            document.documentElement.lang = lang;
            if (lang === 'ar') {
                document.documentElement.dir = 'rtl';
            } else {
                document.documentElement.dir = 'ltr';
            }

            // 3. Mettre à jour le texte
            updateContent(lang);

            // 4. Mettre à jour le bouton de langue (Desktop)
            if (currentLangText) {
                currentLangText.textContent = lang;
            }

            // 5. Mettre à jour les styles du sélecteur (Mobile)
            if (mobileLangOptions) {
                mobileLangOptions.forEach(opt => {
                    if (opt.dataset.lang === lang) {
                        opt.classList.add('font-semibold', 'text-text-dark');
                        opt.classList.remove('font-medium', 'text-text-medium');
                    } else {
                        opt.classList.remove('font-semibold', 'text-text-dark');
                        opt.classList.add('font-medium', 'text-text-medium');
                    }
                });
            }
                        
            // 6. Fermer le menu déroulant (Desktop)
            if (langMenuButton && langMenuDropdown) {
                langMenuButton.classList.remove('active');
                langMenuDropdown.style.display = 'none';
            }
        }


        // --- Fonctions Utilitaires (Mises à jour) ---
        function showMessage(messageKey, type = 'info', params = {}) {
            const msgBox = document.getElementById('message-box');
            if (!msgBox) return;
                        
            const lang = document.documentElement.lang || 'fr';
            let message = translations[lang][messageKey] || messageKey; // Utiliser la clé si la traduction n'est pas trouvée

            // Remplacer les placeholders
            if (params.field) message = message.replace('[FIELD]', params.field);
            if (params.car) message = message.replace('[CAR]', params.car);
                        
            // Stocker les params pour la re-traduction
            msgBox.dataset.key = messageKey;
            msgBox.dataset.messageParams = JSON.stringify(params);

            msgBox.textContent = message;
            msgBox.className = 'p-4 rounded-lg text-center mb-6 font-medium border text-sm md:text-base';
            msgBox.classList.remove('hidden');
                        
            msgBox.classList.remove('bg-green-100', 'border-green-300', 'text-green-800', 'bg-red-100', 'border-red-300', 'text-red-800', 'bg-yellow-100', 'border-yellow-300', 'text-yellow-800', 'bg-blue-100', 'border-blue-300', 'text-blue-800'); 
                            
            if (type === 'success') {
                msgBox.classList.add('bg-green-100', 'border-green-300', 'text-green-800');
            } else if (type === 'error') {
                msgBox.classList.add('bg-red-100', 'border-red-300', 'text-red-800');
            } else if (type === 'warning') {
                 msgBox.classList.add('bg-yellow-100', 'border-yellow-300', 'text-yellow-800');
            } else {
                msgBox.classList.add('bg-blue-100', 'border-blue-300', 'text-blue-800');
            }
                        
            msgBox.style.opacity = '1'; 
            msgBox.style.transform = 'translateY(0)';
                        
            setTimeout(() => {
                if (!msgBox.classList.contains('hidden')) {
                     msgBox.style.opacity = '0'; msgBox.style.transform = 'translateY(-10px)'; 
                     setTimeout(() => msgBox.classList.add('hidden'), 300); 
                 }
            }, 7000);
        }


        function getDateTimeObject(dateStr, hourStr, minuteStr) {
            if (!dateStr || hourStr === "" || minuteStr === "") return null;
            try {
                const hour = hourStr.padStart(2, '0');
                const minute = minuteStr.padStart(2, '0');
                const [year, month, day] = dateStr.split('-');
                                
                const d = new Date(Date.UTC(parseInt(year), parseInt(month) - 1, parseInt(day), parseInt(hour), parseInt(minute), 0));

                if (isNaN(d.getTime())) { throw new Error("Invalid date created"); }
                return d;
            } catch (e) {
                console.error("Erreur conversion date/heure:", dateStr, hourStr, minuteStr, e);
                showMessage("formErrorInvalidDates", "error"); // Clé de traduction
                return null;
            }
        }

        function formatReadableDateTime(dateObj) {
            if (!dateObj || isNaN(dateObj.getTime())) return "Date invalide"; 
            const options = { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' }; 
            try { 
                 let formatted = new Intl.DateTimeFormat('fr-FR', options).format(dateObj); 
                 formatted = formatted.replace(/[\s,]+/g, ' ').trim(); 
                 return formatted; 
             } catch (e) { 
                 console.error("Error formatting date:", e); 
                 const day = String(dateObj.getUTCDate()).padStart(2, '0'); 
                 const month = String(dateObj.getUTCMonth() + 1).padStart(2, '0'); 
                 const year = dateObj.getUTCFullYear(); 
                 const hours = String(dateObj.getUTCHours()).padStart(2, '0'); 
                 const minutes = String(dateObj.getUTCMinutes()).padStart(2, '0'); 
                 return `${day}/${month}/${year} ${hours}h${minutes}`; 
             }
        }

        // --- Remplissage des Selects Heure/Minute ---
        function populateTimeSelects() {
            const hourSelects = [document.getElementById('heurePriseEnChargeHeure'), document.getElementById('heureRetourHeure')];
            const minuteSelects = [document.getElementById('heurePriseEnChargeMinute'), document.getElementById('heureRetourMinute')];

            hourSelects.forEach(select => {
                if (!select) return;
                const placeholder = select.querySelector('option[disabled]');
                 const placeholderKey = placeholder.dataset.key;
                select.innerHTML = ''; 
                 if (placeholder) {
                     select.appendChild(placeholder);
                     placeholder.textContent = translations[document.documentElement.lang || 'fr'][placeholderKey];
                 }
                for (let i = 0; i < 24; i++) { const value = i.toString().padStart(2, '0'); select.options.add(new Option(value, value)); }
            });

            minuteSelects.forEach(select => {
                if (!select) return;
                 const placeholder = select.querySelector('option[disabled]');
                 const placeholderKey = placeholder.dataset.key;
                 select.innerHTML = ''; 
                  if (placeholder) {
                      select.appendChild(placeholder);
                      placeholder.textContent = translations[document.documentElement.lang || 'fr'][placeholderKey];
                  }
                 ['00', '15', '30', '45'].forEach(value => { 
                     select.options.add(new Option(value, value)); 
                 });
            });
        }

        // --- Vérification de Disponibilité Spécifique (Version SANS Index) ---
        function checkCarAvailabilityJS(carName, pickupDateTime, returnDateTime, allManualStatuses, allUnavailabilityPeriods) {
             if (!carName || !pickupDateTime || !returnDateTime || isNaN(pickupDateTime) || isNaN(returnDateTime)) {
                 console.error("Données invalides pour checkCarAvailabilityJS", carName, pickupDateTime, returnDateTime);
                 return { available: false, reasonKey: 'formUnavailable' };
             }
             try {
                 if (allManualStatuses.get(carName) === 'unavailable') {
                     console.log(`Vérif JS: ${carName} est marqué Indisponible (Maintenance)`);
                      return { available: false, reasonKey: 'formUnavailable' }; // Clé de traduction
                 }
                 
                 const carPeriods = allUnavailabilityPeriods.get(carName) || [];
                 let isUnavailable = false;

                 for (const period of carPeriods) {
                     const periodStart = period.startDate.toDate();
                     const periodEnd = period.endDate.toDate();
                     if (pickupDateTime < periodEnd && returnDateTime > periodStart) {
                         console.log(`Vérif JS: ${carName} est indisponible. Conflit trouvé: ${formatReadableDateTime(periodStart)} à ${formatReadableDateTime(periodEnd)}`);
                         isUnavailable = true;
                         break;
                     }
                 }

                 if (isUnavailable) {
                      return { available: false, reasonKey: 'formUnavailable' }; // Clé de traduction
                 }
                 
                 console.log(`Vérif JS: ${carName} est Disponible`);
                 return { available: true, reasonKey: null };

             } catch (error) {
                 console.error(`Erreur JS lors de la vérification de disponibilité pour ${carName}:`, error);
                 showMessage("formErrorCheck", "error"); // Clé de traduction
                 return { available: false, reasonKey: 'formErrorCheck' };
             }
        }


        // --- Logique de Vérification de Disponibilité (Bouton Principal) (SANS Index) ---
        async function handleCheckAvailability() {
             console.log("Vérification de la disponibilité lancée...");
             if (!dbReady) { showMessage("formErrorDB", "error"); return; }
                             
             const datePriseEnChargeInput = document.getElementById('datePriseEnCharge');
             const heurePriseEnChargeHeureSelect = document.getElementById('heurePriseEnChargeHeure');
             const heurePriseEnChargeMinuteSelect = document.getElementById('heurePriseEnChargeMinute');
             const dateRetourInput = document.getElementById('dateRetour');
             const heureRetourHeureSelect = document.getElementById('heureRetourHeure');
             const heureRetourMinuteSelect = document.getElementById('heureRetourMinute');
             const availabilitySpinner = document.getElementById('availability-spinner');
             const checkAvailabilityButton = document.getElementById('check-availability-button');
             const availableCarsSection = document.getElementById('available-cars-section');
             const availableCarsListDiv = document.getElementById('available-cars-list');
             const noCarsMessage = document.getElementById('no-cars-message');
             const submitBookingButton = document.getElementById('submit-booking-button');
             const selectedCarInput = document.getElementById('selectedCar');
             const messageBox = document.getElementById('message-box');

             const startDateStr = datePriseEnChargeInput.value; const startHourStr = heurePriseEnChargeHeureSelect.value;
             const startMinuteStr = heurePriseEnChargeMinuteSelect.value; const endDateStr = dateRetourInput.value;
             const endHourStr = heureRetourHeureSelect.value; const endMinuteStr = heureRetourMinuteSelect.value;
             
             if (!startDateStr || startHourStr === "" || startMinuteStr === "" || !endDateStr || endHourStr === "" || endMinuteStr === "") { showMessage("formErrorDatesRequired", "warning"); return; }
             
             currentPickupDateTime = getDateTimeObject(startDateStr, startHourStr, startMinuteStr);
             currentReturnDateTime = getDateTimeObject(endDateStr, endHourStr, endMinuteStr);
             
             if (!currentPickupDateTime || !currentReturnDateTime) { return; }
             
             const now = new Date();
             const todayStart = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate())); 
             
             if (currentPickupDateTime < todayStart) { showMessage("formErrorDatePast", "warning"); return; } 
             
             if (currentPickupDateTime >= currentReturnDateTime) { showMessage("formErrorDateEnd", "warning"); return; }

             availabilitySpinner.classList.remove('hidden'); checkAvailabilityButton.disabled = true;
             availableCarsSection.classList.add('hidden'); availableCarsListDiv.innerHTML = '';
             noCarsMessage.classList.add('hidden'); submitBookingButton.classList.add('hidden');
             selectedCarName = null; selectedCarInput.value = ''; messageBox.classList.add('hidden');

             try {
                 const manualStatusesSnap = await getDocs(carManualStatusCollectionRef);
                 const manualStatusMap = new Map();
                 manualStatusesSnap.forEach(doc => { manualStatusMap.set(doc.id, doc.data().status); });
                 
                 const periodsSnapshot = await getDocs(unavailabilityPeriodsCollectionRef);
                 const unavailabilityMap = new Map();
                 
                 periodsSnapshot.forEach(doc => {
                     const period = doc.data();
                     if (period.startDate && period.endDate && period.car) {
                         if (!unavailabilityMap.has(period.car)) {
                             unavailabilityMap.set(period.car, []);
                         }
                         unavailabilityMap.get(period.car).push(period);
                     }
                 });
                                     
                 availableCarsListDiv.innerHTML = '';
                 let availableCarsCount = 0;
                                     
                 carNames.forEach((carName) => {
                     const carData = carFleet[carName];
                     const availability = checkCarAvailabilityJS(carName, currentPickupDateTime, currentReturnDateTime, manualStatusMap, unavailabilityMap);
                                         
                     availableCarsListDiv.appendChild(createCarCard(carName, carData, availability.available, availability.reasonKey));
                     if (availability.available) {
                         availableCarsCount++;
                     }
                 });

                 availableCarsSection.classList.remove('hidden');
                 noCarsMessage.classList.toggle('hidden', availableCarsCount > 0);
                 
                 availableCarsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

             } catch (error) {
                 console.error("Erreur globale lors de la vérification:", error);
                 showMessage("formErrorCheck", "error");
             } finally {
                 availabilitySpinner.classList.add('hidden'); checkAvailabilityButton.disabled = false;
             }
        }


        // --- Création Carte Voiture (Mise à jour pour traduction) ---
         function createCarCard(carName, carData, isAvailable, unavailableReasonKey = "formUnavailable") {
             const card = document.createElement('div');
             const availabilityClasses = isAvailable ? 'cursor-pointer group' : 'opacity-60 cursor-not-allowed';
             card.className = `car-card ${availabilityClasses} shadow-lg hover:shadow-primary/20`;
             card.dataset.carName = carName;

             const lang = document.documentElement.lang || 'fr';
             const selectText = translations[lang]['formSelectCar'];
             const selectedText = translations[lang]['formSelectedCar'];
             const unavailableText = translations[lang][unavailableReasonKey];
             const carNameKey = `car${carNames.indexOf(carName) + 1}Name`; // ex: car1Name, car2Name...
             const carDescKey = `car${carNames.indexOf(carName) + 1}Desc`;
             const pricePerDayText = translations[lang]['carPricePerDay'];
             const reserveText = translations[lang]['carReserve'];

             card.innerHTML = `
                 <div class="relative overflow-hidden rounded-t-lg">
                     <img src="${carData.image || 'https://placehold.co/300x200/e2e8f0/cbd5e0?text=Image+Voiture'}" alt="${carName}" class="w-full h-52 object-cover ${isAvailable ? 'group-hover:scale-110' : ''} transition-transform duration-500 ease-in-out" onerror="this.onerror=null; this.src='https://placehold.co/300x200/e0e0e0/a0a0a0?text=Image+Indispo';">
                     ${!isAvailable ? `<div class="absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center rounded-t-lg"><span class="text-white font-semibold text-sm px-3 py-1 rounded bg-red-600 shadow">${unavailableText}</span></div>` : ''}
                     <div class="absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-black/60 to-transparent pointer-events-none"></div>
                 </div>
                 <div class="p-6">
                     <h4 class="text-xl font-bold text-text-dark mb-2 truncate" data-key="${carNameKey}">${translations[lang][carNameKey]}</h4>
                     <p class="mb-4 text-sm h-10 text-text-medium" data-key="${carDescKey}">${translations[lang][carDescKey]}</p>
                     <div class="flex justify-between items-center mb-5">
                          <p class="text-2xl font-extrabold text-primary price">${carData.price}<span class="text-sm font-medium text-text-medium" data-key="carPricePerDay"> ${pricePerDayText}</span></p>
                     </div>
                     <button type="button" class="select-car-button btn w-full ${isAvailable ? 'btn-primary' : 'bg-gray-400 text-gray-700 cursor-not-allowed'} text-sm py-3" ${!isAvailable ? 'disabled' : ''}>
                         <span class="button-text">${isAvailable ? selectText : unavailableText}</span>
                         ${isAvailable ? '<i class="fas fa-check ml-1 icon-check hidden"></i>' : ''}
                     </button>
                 </div>
             `;

              if (isAvailable) {
                  const selectButton = card.querySelector('.select-car-button');
                  const buttonText = selectButton.querySelector('.button-text');
                  const checkIcon = selectButton.querySelector('.icon-check');
                                      
                  const availableCarsListDiv = document.getElementById('available-cars-list');
                  const submitBookingButton = document.getElementById('submit-booking-button');
                  const selectedCarInput = document.getElementById('selectedCar');
                  const submitSpinner = document.getElementById('submit-spinner');


                  card.addEventListener('click', (e) => {
                      if (e.target.closest('button') && e.target.closest('button').disabled) return;
                                          
                      const currentLang = document.documentElement.lang || 'fr';
                      const selectText = translations[currentLang]['formSelectCar'];
                      const selectedText = translations[currentLang]['formSelectedCar'];

                      document.querySelectorAll('.car-card.selected').forEach(selectedCard => {
                          selectedCard.classList.remove('selected', 'border-2');
                          const btn = selectedCard.querySelector('.select-car-button');
                          if (btn) {
                              btn.querySelector('.button-text').textContent = selectText;
                              btn.querySelector('.icon-check')?.classList.add('hidden');
                              btn.classList.remove('bg-green-600', 'hover:bg-green-700', 'cursor-not-allowed', 'selected-btn', 'text-white');
                              btn.classList.add('btn-primary');
                              btn.disabled = false;
                          }
                      });
                      
                      card.classList.add('selected', 'border-2');
                      
                      buttonText.textContent = selectedText;
                      checkIcon?.classList.remove('hidden');
                      selectButton.classList.remove('btn-primary');
                      selectButton.classList.add('bg-green-600', 'hover:bg-green-700', 'cursor-not-allowed', 'selected-btn', 'text-white');
                      selectButton.disabled = true;
                      
                      selectedCarName = carName;
                      selectedCarInput.value = carName;
                      
                      submitBookingButton.classList.remove('hidden');
                      submitBookingButton.disabled = false; submitSpinner.classList.add('hidden');
                  });
              }
             return card;
         }


        // --- Logique de Soumission Finale (Mise à jour pour traduction) ---
        async function handleSubmitBooking() {
             console.log("Submit button clicked");
                             
             const form = document.getElementById('booking-form');
             const submitBookingButton = document.getElementById('submit-booking-button');
             const submitSpinner = document.getElementById('submit-spinner');
             const checkAvailabilityButton = document.getElementById('check-availability-button');

             if (!dbReady) {
                 showMessage("formErrorDB", "error");
                 return;
             }
             if (!selectedCarName) { showMessage("formErrorSelectCar", "warning"); return; }
             if (!currentPickupDateTime || !currentReturnDateTime) { showMessage("formErrorInvalidDates", "warning"); return; }

             const formData = new FormData(form);
             const bookingData = Object.fromEntries(formData.entries());
             
             const requiredFields = [
                 { id: 'nomPrenom', key: 'formNameLabel' },
                 { id: 'telephone', key: 'formPhoneLabel' },
                 { id: 'email', key: 'formEmailLabel' },
                 { id: 'lieuPriseEnCharge', key: 'formPickupLocationLabel' },
                 { id: 'lieuRetour', key: 'formReturnLocationLabel' },
                 { id: 'datePriseEnCharge', key: 'formStartDateLabel' },
                 { id: 'heurePriseEnChargeHeure', key: 'formHour' },
                 { id: 'heurePriseEnChargeMinute', key: 'formMinute' },
                 { id: 'dateRetour', key: 'formEndDateLabel' },
                 { id: 'heureRetourHeure', key: 'formHour' },
                 { id: 'heureRetourMinute', key: 'formMinute' }
             ];

             let firstEmptyField = null;
             let formIsValid = true;
             const lang = document.documentElement.lang || 'fr';

             for (const field of requiredFields) {
                 if (!bookingData[field.id] || bookingData[field.id] === "") {
                     formIsValid = false;
                     const label = translations[lang][field.key] || field.id;
                     showMessage("formErrorFieldRequired", "warning", { field: label });
                     if (!firstEmptyField) firstEmptyField = document.getElementById(field.id);
                 }
             }
             if (!formIsValid) {
                 if (firstEmptyField) firstEmptyField.focus();
                 return;
             }

             submitBookingButton.disabled = true; submitSpinner.classList.remove('hidden'); messageBox.classList.add('hidden');

             // *** FINAL AVAILABILITY CHECK ***
             const manualStatusesSnap = await getDocs(carManualStatusCollectionRef);
             const manualStatusMap = new Map();
             manualStatusesSnap.forEach(doc => { manualStatusMap.set(doc.id, doc.data().status); });
             const periodsSnapshot = await getDocs(unavailabilityPeriodsCollectionRef);
             const unavailabilityMap = new Map();
             periodsSnapshot.forEach(doc => {
                 const period = doc.data();
                 if (period.startDate && period.endDate && period.car) {
                     if (!unavailabilityMap.has(period.car)) { unavailabilityMap.set(period.car, []); }
                     unavailabilityMap.get(period.car).push(period);
                 }
             });
             const availabilityCheck = checkCarAvailabilityJS(selectedCarName, currentPickupDateTime, currentReturnDateTime, manualStatusMap, unavailabilityMap);
             if (!availabilityCheck.available) {
                 showMessage("formErrorCarUnavailable", "error", { car: selectedCarName });
                 
                 checkAvailabilityButton.click(); 
                 
                 submitBookingButton.classList.add('hidden');
                 submitBookingButton.disabled = false; submitSpinner.classList.add('hidden');
                 return;
             }
             
             const heurePriseStr = `${bookingData.heurePriseEnChargeHeure.padStart(2, '0')}:${bookingData.heurePriseEnChargeMinute.padStart(2, '0')}`;
             const heureRetourStr = `${bookingData.heureRetourHeure.padStart(2, '0')}:${bookingData.heureRetourMinute.padStart(2, '0')}`;
                             
             const pickupTimestamp = Timestamp.fromDate(currentPickupDateTime);
             const returnTimestamp = Timestamp.fromDate(currentReturnDateTime);

             const bookingDetails = {
                 nomPrenom: bookingData.nomPrenom, telephone: bookingData.telephone, email: bookingData.email, lieuPriseEnCharge: bookingData.lieuPriseEnCharge, lieuRetour: bookingData.lieuRetour, 
                 datePriseEnCharge: bookingData.datePriseEnCharge, heurePriseEnCharge: heurePriseStr, 
                 dateRetour: bookingData.dateRetour, heureRetour: heureRetourStr,
                 voiture: selectedCarName, 
                 timestamp: serverTimestamp(),
                 pickupTimestamp: pickupTimestamp,
                 returnTimestamp: returnTimestamp,
                 confirmed: false, 
                 deleted: false
             };
             
             let newBookingId = null;

             // 1. Save to Firestore
             try {
                 const docRef = await addDoc(bookingsCollectionRef, bookingDetails);
                 newBookingId = docRef.id;
             } catch (error) {
                 console.error("Erreur Firestore lors de l'enregistrement: ", error); 
                 showMessage("formErrorBookingDB", 'error');
                 submitBookingButton.disabled = false; submitSpinner.classList.add('hidden');
                 return;
             }

             // 2. Send via Web3Forms
             try {
                 const objectForWeb3Forms = { ...bookingDetails };
                 objectForWeb3Forms.access_key = form.querySelector('input[name="access_key"]').value;
                 objectForWeb3Forms.subject = form.querySelector('input[name="subject"]').value;
                 objectForWeb3Forms.from_name = form.querySelector('input[name="from_name"]').value;
                 objectForWeb3Forms.redirect = form.querySelector('input[name="redirect"]').value;
                 
                 objectForWeb3Forms.datePriseEnCharge = `${bookingDetails.datePriseEnCharge} ${bookingDetails.heurePriseEnCharge}`;
                 objectForWeb3Forms.dateRetour = `${bookingDetails.dateRetour} ${bookingDetails.heureRetour}`;
                 objectForWeb3Forms.timestamp_readable = formatReadableDateTime(new Date());

                 delete objectForWeb3Forms.timestamp; 
                 delete objectForWeb3Forms.pickupTimestamp;
                 delete objectForWeb3Forms.returnTimestamp;
                 delete objectForWeb3Forms.confirmed; delete objectForWeb3Forms.deleted; delete objectForWeb3Forms.heurePriseEnCharge; delete objectForWeb3Forms.heureRetour;

                 const jsonPayload = JSON.stringify(objectForWeb3Forms);
                 const web3Response = await fetch("https://api.web3forms.com/submit", { method: "POST", headers: { "Content-Type": "application/json", "Accept": "application/json" }, body: jsonPayload });
                 const result = await web3Response.json();
                                     
                 const availableCarsSection = document.getElementById('available-cars-section');
                 const selectedCarInput = document.getElementById('selectedCar');

                 if (result.success) {
                     showMessage("formSuccess", 'success');
                     form.reset(); 
                     document.getElementById('heurePriseEnChargeHeure').value = ""; 
                     document.getElementById('heurePriseEnChargeMinute').value = ""; 
                     document.getElementById('heureRetourHeure').value = ""; 
                     document.getElementById('heureRetourMinute').value = "";
                     availableCarsSection.classList.add('hidden'); 
                     submitBookingButton.classList.add('hidden');
                     selectedCarName = null; 
                     selectedCarInput.value = '';
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                 } else {
                     console.error('Web3Forms Error:', result);
                     showMessage("formWarningEmail", 'warning');
                     form.reset();
                     document.getElementById('heurePriseEnChargeHeure').value = ""; 
                     document.getElementById('heurePriseEnChargeMinute').value = ""; 
                     document.getElementById('heureRetourHeure').value = ""; 
                     document.getElementById('heureRetourMinute').value = "";
                     availableCarsSection.classList.add('hidden'); 
                     submitBookingButton.classList.add('hidden');
                     selectedCarName = null; 
                     selectedCarInput.value = '';
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                 }
             } catch (web3Error) {
                 console.error('Erreur fetch Web3Forms:', web3Error);
                  showMessage("formWarningEmail", 'warning');
                 form.reset();
                 document.getElementById('heurePriseEnChargeHeure').value = ""; 
                 document.getElementById('heurePriseEnChargeMinute').value = ""; 
                 document.getElementById('heureRetourHeure').value = ""; 
                 document.getElementById('heureRetourMinute').value = "";
                 document.getElementById('available-cars-section').classList.add('hidden'); 
                 submitBookingButton.classList.add('hidden');
                 selectedCarName = null; 
                 document.getElementById('selectedCar').value = '';
                 window.scrollTo({ top: 0, behavior: 'smooth' });
             } finally {
                 submitBookingButton.disabled = false; submitSpinner.classList.add('hidden');
             }
        }


        // --- Header Scroll Effect ---
        function handleScroll() {
            const mainHeader = document.getElementById('main-header');
            const logoWhiteMobile = document.getElementById('logo-mobile-white');
            const logoColorMobile = document.getElementById('logo-mobile-color');
            const logoWhiteDesktop = document.getElementById('logo-desktop-white');
            const logoColorDesktop = document.getElementById('logo-desktop-color');

             const scrollPosition = window.scrollY;
             if (scrollPosition > 50) {
                 mainHeader.classList.add('scrolled');
             } else {
                 mainHeader.classList.remove('scrolled');
             }
                             
             if (logoWhiteMobile && logoColorMobile && logoWhiteDesktop && logoColorDesktop) {
                 if (scrollPosition > 50) {
                     logoWhiteMobile.style.opacity = '0';
                     logoColorMobile.style.opacity = '1';
                     logoWhiteDesktop.style.opacity = '0';
                     logoColorDesktop.style.opacity = '1';
                 } else {
                     logoWhiteMobile.style.opacity = '1';
                     logoColorMobile.style.opacity = '0';
                     logoWhiteDesktop.style.opacity = '1';
                     logoColorDesktop.style.opacity = '0';
                 }
             }
        }

        // --- Mobile Menu Toggle ---
        function setupMobileMenu() {
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', (e) => { e.stopPropagation(); mobileMenu.classList.toggle('hidden'); });
                
                document.addEventListener('click', (e) => {
                    if (!mobileMenu.contains(e.target) && !mobileMenuButton.contains(e.target)) {
                        mobileMenu.classList.add('hidden');
                    }
                });
                
                 mobileMenu.querySelectorAll('a').forEach(link => { 
                     // Ne fermez pas le menu si on clique sur une option de langue
                     if (!link.classList.contains('lang-option')) {
                         link.addEventListener('click', () => { mobileMenu.classList.add('hidden'); }); 
                     }
                 });
            }
        }

        // --- Function to show/hide reservation form with animation (CORRECTED LOGIC) ---
        function toggleReservationForm(show) {
            const reservationSectionEl = document.getElementById('reservation');
            if (!reservationSectionEl) {
                console.error("Reservation section #reservation introuvable!");
                return;
            }

            const visibleClasses = ['max-h-[3000px]', 'opacity-100', 'py-20', 'md:py-32', 'my-16', 'md:my-24'];
            const hiddenClasses = ['max-h-0', 'opacity-0', 'p-0', 'm-0'];

            if (show) {
                reservationSectionEl.style.display = 'block'; 
                
                requestAnimationFrame(() => {
                    hiddenClasses.forEach(c => reservationSectionEl.classList.remove(c));
                    visibleClasses.forEach(c => reservationSectionEl.classList.add(c));
                    
                    setTimeout(() => {
                        reservationSectionEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 50); 
                });
            } else {
                 visibleClasses.forEach(c => reservationSectionEl.classList.remove(c));
                 hiddenClasses.forEach(c => reservationSectionEl.classList.add(c));
            }
        }

        // --- FIN DES FONCTIONS RESTAURÉES ---


        // --- Initialize time selects and hide reservation section on load ---
        document.addEventListener('DOMContentLoaded', () => {
             console.log("DOMContentLoaded: Page chargée.");

             // --- DÉFINITION DES VARIABLES GLOBALES ---
             selectedCarName = null;
             currentPickupDateTime = null;
             currentReturnDateTime = null;

             // --- DÉFINITION DES ÉLÉMENTS DOM ---
             mainHeader = document.getElementById('main-header');
             heroReserveButton = document.getElementById('hero-reserve-button');
             scrollDownButton = document.getElementById('scroll-down-button');
             reservationSection = document.getElementById('reservation');
             form = document.getElementById('booking-form');
             messageBox = document.getElementById('message-box');
             checkAvailabilityButton = document.getElementById('check-availability-button');
             availabilitySpinner = document.getElementById('availability-spinner');
             availableCarsSection = document.getElementById('available-cars-section');
             availableCarsListDiv = document.getElementById('available-cars-list');
             noCarsMessage = document.getElementById('no-cars-message');
             submitBookingButton = document.getElementById('submit-booking-button');
             submitSpinner = document.getElementById('submit-spinner');
             selectedCarInput = document.getElementById('selectedCar');
             mobileMenuButton = document.getElementById('mobile-menu-button');
             mobileMenu = document.getElementById('mobile-menu');
             navReserveButton = document.getElementById('nav-reserve-button');
             mobileReserveButton = document.getElementById('mobile-reserve-button');
             reserveNowLinks = document.querySelectorAll('.reserve-now-link');
                             
             logoWhiteMobile = document.getElementById('logo-mobile-white');
             logoColorMobile = document.getElementById('logo-mobile-color');
             logoWhiteDesktop = document.getElementById('logo-desktop-white');
             logoColorDesktop = document.getElementById('logo-desktop-color');

             nomPrenomInput = document.getElementById('nomPrenom');
             telephoneInput = document.getElementById('telephone');
             emailInput = document.getElementById('email');
             lieuPriseEnChargeInput = document.getElementById('lieuPriseEnCharge');
             lieuRetourInput = document.getElementById('lieuRetour');
             datePriseEnChargeInput = document.getElementById('datePriseEnCharge');
             heurePriseEnChargeHeureSelect = document.getElementById('heurePriseEnChargeHeure');
             heurePriseEnChargeMinuteSelect = document.getElementById('heurePriseEnChargeMinute');
             dateRetourInput = document.getElementById('dateRetour');
             heureRetourHeureSelect = document.getElementById('heureRetourHeure');
             heureRetourMinuteSelect = document.getElementById('heureRetourMinute');
             currentYearSpan = document.getElementById('current-year');

             // NOUVEAU: Éléments de langue
             langMenuButton = document.getElementById('lang-menu-button');
             langMenuDropdown = document.getElementById('lang-menu-dropdown');
             langOptions = document.querySelectorAll('.lang-option');
             mobileLangOptions = document.querySelectorAll('#mobile-menu .lang-option');
             currentLangText = document.getElementById('current-lang-text');

                             
             // --- ATTACHEMENT DES ÉCOUTEURS D'ÉVÉNEMENTS ---

             if (checkAvailabilityButton) {
                 checkAvailabilityButton.addEventListener('click', handleCheckAvailability);
             }
             if (submitBookingButton) {
                 submitBookingButton.addEventListener('click', handleSubmitBooking);
             }
                             
             window.addEventListener('scroll', handleScroll);
                             
             setupMobileMenu(); // Gère les écouteurs du menu mobile
                             
             // --- Footer Current Year ---
             if (currentYearSpan) {
                 currentYearSpan.textContent = new Date().getFullYear();
             }

             // --- Event Listeners for showing the form ---
             const reservationTriggers = [
                 heroReserveButton,
                 scrollDownButton,
                 navReserveButton,
                 mobileReserveButton,
                 ...reserveNowLinks
             ];
             
             reservationTriggers.forEach(trigger => {
                 if(trigger) {
                     trigger.addEventListener('click', (event) => {
                         event.preventDefault();
                         toggleReservationForm(true);
                     });
                 }
             });

             // --- NOUVEAU: Écouteurs de langue ---
             if (langMenuButton && langMenuDropdown) {
                 langMenuButton.addEventListener('click', (e) => {
                     e.stopPropagation();
                     langMenuButton.classList.toggle('active');
                     langMenuDropdown.style.display = langMenuButton.classList.contains('active') ? 'block' : 'none';
                 });

                 // Fermer le menu en cliquant à l'extérieur
                 document.addEventListener('click', (e) => {
                     if (!langMenuButton.contains(e.target) && !langMenuDropdown.contains(e.target)) {
                         langMenuButton.classList.remove('active');
                         langMenuDropdown.style.display = 'none';
                     }
                 });
             }
             
             langOptions.forEach(option => {
                 option.addEventListener('click', (e) => {
                     e.preventDefault();
                     const lang = e.target.dataset.lang;
                     changeLanguage(lang);
                     
                     // Fermer le menu mobile si on clique sur une langue
                     if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                         mobileMenu.classList.add('hidden');
                     }
                 });
             });


             // --- Initialisation ---
             populateTimeSelects();
                             
             // Appliquer la langue sauvegardée (ou le français par défaut)
             const savedLang = localStorage.getItem('language') || 'fr';
             changeLanguage(savedLang);

             const reservationSectionEl = document.getElementById('reservation');
             if (reservationSectionEl) {
                 reservationSectionEl.classList.add('max-h-0', 'opacity-0', 'overflow-hidden', 'p-0', 'm-0');
                 reservationSectionEl.classList.remove('py-20', 'md:py-32', 'my-16', 'md:my-24');
                 reservationSectionEl.style.display = 'block'; 
             } else {
                 console.error("Reservation section element not found on DOMContentLoaded");
             }
                             
             // --- Section Animations on Scroll ---
             try {
                 const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
                 const observerCallback = (entries, observer) => {
                     entries.forEach(entry => {
                         if (entry.isIntersecting) {
                             if (entry.target.id === 'reservation') {
                                 observer.unobserve(entry.target);
                                 return;
                             }
                             entry.target.classList.add('visible'); 
                             observer.unobserve(entry.target);
                         }
                     });
                 };
                 const observer = new IntersectionObserver(observerCallback, observerOptions);
                 document.querySelectorAll('.section-animate').forEach(section => { 
                     observer.observe(section);
                 });
             } catch(e) {
                 console.error("IntersectionObserver non supporté ou erreur:", e);
                 document.querySelectorAll('.section-animate').forEach(section => { 
                     section.classList.add('visible');
                 });
             }

        });

    </script>
</body>
</html>
