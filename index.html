<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palace Cars - Location de Voitures à Agadir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Firebase et Web3Forms seront gérés dans le script module -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hero-bg { background-image: url('https://placehold.co/1920x800/003366/FFFFFF?text=Bienvenue+chez+Palace+Cars'); background-size: cover; background-position: center; }
        /* Style simple pour le select */
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='%236b7280' class='w-6 h-6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='m19.5 8.25-7.5 7.5-7.5-7.5' /%3E%3C/svg%3E%0A");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem; /* Espace pour la flèche */
        }
         /* Spinner simple */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3b82f6; /* Blue */
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-4 lg:px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-blue-600">PalaceCars</a>
            <div class="hidden md:flex space-x-6 items-center">
                <a href="#accueil" class="text-gray-600 hover:text-blue-600">Accueil</a>
                <a href="#flotte" class="text-gray-600 hover:text-blue-600">Notre Flotte</a>
                <a href="#services" class="text-gray-600 hover:text-blue-600">Services</a>
                <a href="#faq" class="text-gray-600 hover:text-blue-600">FAQ</a>
                <a href="#contact" class="text-gray-600 hover:text-blue-600">Contact</a>
                <a href="#reservation-rapide" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300">Réserver Maintenant</a>
            </div>
            <!-- Mobile Menu Button -->
            <button id="mobile-menu-button" class="md:hidden focus:outline-none">
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-white shadow-md">
            <a href="#accueil" class="block py-2 px-4 text-sm text-gray-700 hover:bg-blue-50">Accueil</a>
            <a href="#flotte" class="block py-2 px-4 text-sm text-gray-700 hover:bg-blue-50">Notre Flotte</a>
            <a href="#services" class="block py-2 px-4 text-sm text-gray-700 hover:bg-blue-50">Services</a>
            <a href="#faq" class="block py-2 px-4 text-sm text-gray-700 hover:bg-blue-50">FAQ</a>
            <a href="#contact" class="block py-2 px-4 text-sm text-gray-700 hover:bg-blue-50">Contact</a>
            <a href="#reservation-rapide" class="block py-2 px-4 text-sm bg-blue-600 text-white text-center rounded-b-md hover:bg-blue-700">Réserver Maintenant</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="accueil" class="hero-bg text-white py-24 md:py-40">
        <div class="container mx-auto px-4 text-center bg-black bg-opacity-50 p-8 rounded-lg max-w-4xl">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4">Location de Voitures à Agadir</h1>
            <p class="text-lg md:text-xl mb-8">Votre partenaire de confiance pour explorer le Maroc en toute liberté.</p>
            <a href="#reservation-rapide" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-md text-lg transition duration-300">Réservez Votre Voiture</a>
        </div>
    </section>

    <!-- Reservation Form Section -->
    <section id="reservation-rapide" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="bg-white p-6 md:p-10 rounded-lg shadow-xl max-w-3xl mx-auto">
                <h2 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-8">Réservation Rapide</h2>
                <!-- Formulaire standard, l'envoi sera géré par JavaScript -->
                <form id="booking-form" class="space-y-6">

                     <!-- Ce champ caché sera utilisé par le script JS pour Web3Forms -->
                     <input type="hidden" name="access_key" value="9a2470af-9163-405c-abc9-3aafd98b14fd"> <!-- VOTRE CLE A ETE INSEREE ICI -->

                    <!-- Personal Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="nomPrenom" class="block text-sm font-medium text-gray-700 mb-1">Nom et Prénom</label>
                            <input type="text" id="nomPrenom" name="nomPrenom" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Votre nom complet">
                        </div>
                        <div>
                            <label for="telephone" class="block text-sm font-medium text-gray-700 mb-1">Numéro de Téléphone</label>
                            <input type="tel" id="telephone" name="telephone" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="+212 6 XX XX XX XX">
                        </div>
                         <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Adresse E-mail</label>
                            <input type="email" id="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="votre.email@exemple.com">
                        </div>
                         <div>
                            <label for="voiture" class="block text-sm font-medium text-gray-700 mb-1">Choisissez une voiture</label>
                            <select id="voiture" name="voiture" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white">
                                <option value="" disabled selected>Sélectionnez un modèle</option>
                                <option value="Citadine Économique (ex: Fiat 500)">Citadine Économique (ex: Fiat 500)</option>
                                <option value="Berline Confort (ex: Dacia Logan)">Berline Confort (ex: Dacia Logan)</option>
                                <option value="SUV (ex: Dacia Duster)">SUV (ex: Dacia Duster)</option>
                                <option value="4x4 Aventure (ex: Toyota Prado)">4x4 Aventure (ex: Toyota Prado)</option>
                                <option value="Minivan (ex: Renault Trafic)">Minivan (ex: Renault Trafic)</option>
                                <option value="Luxe (ex: Mercedes Classe C)">Luxe (ex: Mercedes Classe C)</option>
                                <option value="Autre / Pas de préférence">Autre / Pas de préférence</option>
                            </select>
                        </div>
                    </div>

                    <!-- Pickup Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="lieuPriseEnCharge" class="block text-sm font-medium text-gray-700 mb-1">Lieu de Prise en Charge</label>
                            <input type="text" id="lieuPriseEnCharge" name="lieuPriseEnCharge" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="ex: Aéroport Agadir, Votre hôtel...">
                        </div>
                         <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="datePriseEnCharge" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                <input type="date" id="datePriseEnCharge" name="datePriseEnCharge" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="heurePriseEnCharge" class="block text-sm font-medium text-gray-700 mb-1">Heure</label>
                                <input type="time" id="heurePriseEnCharge" name="heurePriseEnCharge" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Return Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <label for="lieuRetour" class="block text-sm font-medium text-gray-700 mb-1">Lieu de Retour</label>
                            <input type="text" id="lieuRetour" name="lieuRetour" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="ex: Aéroport Agadir, Votre hôtel...">
                        </div>
                         <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="dateRetour" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                <input type="date" id="dateRetour" name="dateRetour" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="heureRetour" class="block text-sm font-medium text-gray-700 mb-1">Heure</label>
                                <input type="time" id="heureRetour" name="heureRetour" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                    </div>

                    <!-- Message Section (utilisée par Firestore et Web3Forms) -->
                    <div id="message-box" class="hidden p-4 rounded-md text-center"></div>

                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" id="submit-button" class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 flex items-center justify-center mx-auto disabled:opacity-50">
                            <span>Soumettre la Demande de Réservation</span>
                            <span id="submit-spinner" class="loader hidden"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Autres sections -->
     <section id="flotte" class="py-16 bg-white">
        <div class="container mx-auto px-4">
             <h2 class="text-3xl font-bold text-center text-gray-800 mb-10">Notre Flotte Populaire</h2>
             <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Car Card Example -->
                <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden transition duration-300 hover:shadow-xl">
                    <img src="https://placehold.co/600x400/cccccc/FFFFFF?text=Fiat+500" alt="Citadine" class="w-full h-48 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/600x400/cccccc/FFFFFF?text=Image+non+disponible';">
                    <div class="p-4">
                        <h3 class="text-lg font-semibold text-gray-800">Citadine Économique</h3>
                        <p class="text-sm text-gray-600 mt-1">Parfaite pour la ville (ex: Fiat 500)</p>
                        <p class="text-blue-600 font-bold mt-2">À partir de 25€ / jour</p>
                    </div>
                </div>
                 <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden transition duration-300 hover:shadow-xl">
                    <img src="https://placehold.co/600x400/cccccc/FFFFFF?text=Dacia+Logan" alt="Berline" class="w-full h-48 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/600x400/cccccc/FFFFFF?text=Image+non+disponible';">
                    <div class="p-4">
                        <h3 class="text-lg font-semibold text-gray-800">Berline Confort</h3>
                        <p class="text-sm text-gray-600 mt-1">Idéale pour les familles (ex: Dacia Logan)</p>
                        <p class="text-blue-600 font-bold mt-2">À partir de 30€ / jour</p>
                    </div>
                </div>
                 <div class="bg-gray-50 rounded-lg shadow-md overflow-hidden transition duration-300 hover:shadow-xl">
                    <img src="https://placehold.co/600x400/cccccc/FFFFFF?text=Dacia+Duster" alt="SUV" class="w-full h-48 object-cover" onerror="this.onerror=null; this.src='https://placehold.co/600x400/cccccc/FFFFFF?text=Image+non+disponible';">
                    <div class="p-4">
                        <h3 class="text-lg font-semibold text-gray-800">SUV Polyvalent</h3>
                        <p class="text-sm text-gray-600 mt-1">Pour la ville et l'aventure (ex: Dacia Duster)</p>
                        <p class="text-blue-600 font-bold mt-2">À partir de 40€ / jour</p>
                    </div>
                </div>
             </div>
        </div>
    </section>

    <section id="services" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
             <h2 class="text-3xl font-bold text-center text-gray-800 mb-10">Nos Services</h2>
             <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                 <div>
                    <div class="text-blue-600 mb-3 inline-block"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V14.25m-17.25 4.5H9.75v-4.5H3.375M9.75 18.75H14.25m-4.5 0v-4.5h4.5v4.5m0-13.5H9.75M14.25 5.25v-1.5a1.125 1.125 0 0 0-1.125-1.125h-3.75a1.125 1.125 0 0 0-1.125 1.125v1.5m17.25 4.5H9.75v-4.5H20.625c.621 0 1.125.504 1.125 1.125v3.375M3.375 5.25H9.75v-1.5a1.125 1.125 0 0 0-1.125-1.125h-3.75a1.125 1.125 0 0 0-1.125 1.125v1.5Z" /></svg></div>
                     <h3 class="text-xl font-semibold mb-2">Large Choix de Véhicules</h3>
                     <p class="text-gray-600">De la citadine économique au 4x4 robuste.</p>
                 </div>
                 <div>
                     <div class="text-blue-600 mb-3 inline-block"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 11.21 12.755 11 12 11s-1.536.21-2.121.727c-1.172.879-1.172 2.303 0 3.182Z" /></svg></div>
                     <h3 class="text-xl font-semibold mb-2">Tarifs Compétitifs</h3>
                     <p class="text-gray-600">Le meilleur rapport qualité/prix à Agadir.</p>
                 </div>
                 <div>
                    <div class="text-blue-600 mb-3 inline-block"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg></div>
                     <h3 class="text-xl font-semibold mb-2">Assistance 24/7</h3>
                     <p class="text-gray-600">Nous sommes là pour vous aider à tout moment.</p>
                 </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="contact" class="bg-gray-800 text-gray-300 py-10">
        <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <h3 class="text-lg font-semibold text-white mb-3">PalaceCars</h3>
                <p class="text-sm">Votre agence de location de voiture de confiance à Agadir, Maroc.</p>
                <p class="text-sm mt-2">&copy; 2025 Palace Cars. Tous droits réservés.</p>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-white mb-3">Navigation</h3>
                <ul class="text-sm space-y-1">
                    <li><a href="#accueil" class="hover:text-white">Accueil</a></li>
                    <li><a href="#flotte" class="hover:text-white">Notre Flotte</a></li>
                    <li><a href="#services" class="hover:text-white">Services</a></li>
                    <li><a href="#faq" class="hover:text-white">FAQ</a></li>
                    <li><a href="#contact" class="hover:text-white">Contact</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-white mb-3">Contactez-nous</h3>
                <p class="text-sm">Adresse: Rue Exemple, Agadir, Maroc</p>
                <p class="text-sm">Téléphone: <a href="tel:+212659198122" class="hover:text-white">+212 659 19 81 22</a></p>
                <p class="text-sm">Email: <a href="mailto:contact@palacecars.ma" class="hover:text-white">contact@palacecars.ma</a></p>
                <!-- Ajouter les liens vers les réseaux sociaux si nécessaire -->
            </div>
        </div>
    </footer>

    <!-- Script pour Firebase ET Web3Forms -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Votre configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCsPHf_v8-gEiWGQzkwses-jOiDXs9tvWo",
            authDomain: "palace-cars.firebaseapp.com",
            projectId: "palace-cars",
            storageBucket: "palace-cars.firebasestorage.app",
            messagingSenderId: "469852272715",
            appId: "1:469852272715:web:6e87dc7083cdc04e03b5ce",
            measurementId: "G-KCEF4WBW0G"
        };


        // --- Initialize Firebase ---
        let db;
        let bookingsCollectionRef;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            // Utiliser le chemin de collection simplifié et fixe
            bookingsCollectionRef = collection(db, "palace_cars_bookings");
            console.log("Firebase initialisé avec succès.");
            // setLogLevel('debug'); // Pour le débogage
        } catch (error) {
            console.error("Erreur d'initialisation Firebase:", error);
            // Afficher une erreur si Firebase ne s'initialise pas
             const messageBox = document.getElementById('message-box');
             if(messageBox) {
                messageBox.textContent = "Erreur de connexion au service de réservation. Veuillez réessayer plus tard.";
                messageBox.className = 'p-4 rounded-md text-center bg-red-100 text-red-700';
                messageBox.classList.remove('hidden');
             }
        }

        // --- DOM Elements ---
        const form = document.getElementById('booking-form');
        const messageBox = document.getElementById('message-box');
        const submitButton = document.getElementById('submit-button');
        const submitSpinner = document.getElementById('submit-spinner');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const web3formsAccessKeyInput = form.querySelector('input[name="access_key"]'); // Trouver l'input caché

        // --- Mobile Menu Toggle ---
        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            // Close menu when a link is clicked
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                });
            });
        }

        // --- Form Submission Logic (Firestore + Web3Forms) ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent default form submission

            if (!db) {
                showMessage("Erreur : Le service de réservation n'est pas disponible.", 'error');
                return;
            }

            // Disable button and show spinner
            submitButton.disabled = true;
            submitSpinner.classList.remove('hidden');
            submitButton.querySelector('span').textContent = "Envoi en cours..."; // Change text
            showMessage('Envoi de votre demande...', 'loading'); // Indicate loading

            // Get form data for Firestore (incluant le timestamp)
            const formData = new FormData(form);
            const bookingDataFirestore = {
                nomPrenom: formData.get('nomPrenom')?.trim() || null,
                telephone: formData.get('telephone')?.trim() || null,
                email: formData.get('email')?.trim() || null,
                voiture: formData.get('voiture') || null,
                lieuPriseEnCharge: formData.get('lieuPriseEnCharge')?.trim() || null,
                datePriseEnCharge: formData.get('datePriseEnCharge') || null,
                heurePriseEnCharge: formData.get('heurePriseEnCharge') || null,
                lieuRetour: formData.get('lieuRetour')?.trim() || null,
                dateRetour: formData.get('dateRetour') || null,
                heureRetour: formData.get('heureRetour') || null,
                timestamp: serverTimestamp(), // Timestamp pour Firestore
                confirmed: false,
                deleted: false
            };

            // Get form data for Web3Forms (sans le timestamp objet)
            const objectForWeb3Forms = Object.fromEntries(formData);
            // Ajout du sujet et nom expéditeur pour Web3Forms (si non défini dans les hidden inputs)
             objectForWeb3Forms.subject = "Nouvelle Demande de Réservation - Palace Cars";
             objectForWeb3Forms.from_name = "Site Web Palace Cars";
             // UTILISATION DE VOTRE CLÉ D'ACCÈS
             objectForWeb3Forms.access_key = "9a2470af-9163-405c-abc9-3aafd98b14fd"; // <-- VOTRE CLE EST ICI !


            // Basic validation
            if (!bookingDataFirestore.nomPrenom || !bookingDataFirestore.telephone || !bookingDataFirestore.datePriseEnCharge || !bookingDataFirestore.heurePriseEnCharge || !bookingDataFirestore.dateRetour || !bookingDataFirestore.heureRetour || !bookingDataFirestore.email || !bookingDataFirestore.voiture) {
                showMessage("Veuillez remplir tous les champs obligatoires.", 'error');
                resetSubmitButton();
                return;
            }

            let firestoreSuccess = false;

            // --- 1. Save to Firestore ---
            try {
                const docRef = await addDoc(bookingsCollectionRef, bookingDataFirestore);
                console.log("Réservation enregistrée avec succès dans Firestore avec ID: ", docRef.id);
                firestoreSuccess = true;
            } catch (error) {
                console.error("Erreur lors de l'enregistrement dans Firestore: ", error);
                showMessage("Une erreur s'est produite lors de l'enregistrement de votre demande. Veuillez réessayer.", 'error');
                resetSubmitButton(); // Réactiver le bouton si Firestore échoue
                return; // Arrêter le processus ici
            }

            // --- 2. Send Email via Web3Forms (SEULEMENT si Firestore a réussi) ---
            if (firestoreSuccess) {
                console.log("Envoi des données à Web3Forms...");
                 const jsonForWeb3Forms = JSON.stringify(objectForWeb3Forms);

                 try {
                     const response = await fetch('https://api.web3forms.com/submit', {
                         method: 'POST',
                         headers: {
                             'Content-Type': 'application/json',
                             'Accept': 'application/json'
                         },
                         body: jsonForWeb3Forms
                     });

                     const result = await response.json();

                     if (result.success) {
                         console.log('Web3Forms Success:', result);
                         showMessage("Demande Envoyée avec Succès ! Vous recevrez bientôt un email de confirmation.", 'success'); // Message unique pour les deux succès
                         form.reset(); // Vider le formulaire
                     } else {
                         console.error('Web3Forms Error:', result);
                         // Afficher le succès de Firestore mais avertir pour l'email
                         showMessage(`Votre demande est enregistrée, mais l'envoi de l'e-mail de notification a échoué (${result.message || ''}). Vous serez contacté.`, 'warning'); // Utiliser un style 'warning'
                         form.reset(); // Vider quand même
                     }
                 } catch (error) {
                     console.error('Web3Forms Fetch Error:', error);
                      // Afficher le succès de Firestore mais avertir pour l'email
                     showMessage("Votre demande est enregistrée, mais une erreur réseau a empêché l'envoi de l'e-mail de notification. Vous serez contacté.", 'warning');
                     form.reset(); // Vider quand même
                 } finally {
                    resetSubmitButton(); // Réactiver le bouton après la tentative Web3Forms
                 }
            }
        });

        // --- Helper Functions ---
        function showMessage(msg, type) {
            messageBox.textContent = msg;
            messageBox.classList.remove('hidden', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700', 'bg-blue-100', 'text-blue-700', 'bg-yellow-100', 'text-yellow-700'); // Remove all color classes
            if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-700');
            } else if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-700');
            } else if (type === 'warning') {
                messageBox.classList.add('bg-yellow-100', 'text-yellow-700');
            } else { // 'loading' or default
                messageBox.classList.add('bg-blue-100', 'text-blue-700');
            }
        }

        function resetSubmitButton() {
            submitButton.disabled = false;
            submitSpinner.classList.add('hidden');
            submitButton.querySelector('span').textContent = "Soumettre la Demande de Réservation";
        }
    </script>
    <!-- Script hCaptcha (si vous l'utilisez avec Web3Forms) -->
    <!-- <script src="https://js.hcaptcha.com/1/api.js" async defer></script> -->

</body>
</html>

